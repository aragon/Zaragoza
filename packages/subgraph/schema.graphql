# Types

# Packages

type DaoPackage @entity {
  id: ID! # Dao + Package
  pkg: Package!
  dao: Dao!
}

type Package @entity {
  id: ID! # address
  daos: [DaoPackage!] @derivedFrom(field: "pkg")
}

# Token

type ERC20Token @entity {
  id: ID! # use address as id
  name: String!
  symbol: String!
  decimals: BigInt!
}

type Balance @entity {
  id: ID! # token address + dao address
  token: ERC20Token! # address(0) will be considered as ETH (or canonical token)
  dao: Dao!
  balance: BigInt!
  lastUpdated: BigInt!
}

# Dao

# ACL

type Role @entity {
  id: ID! # where + role
  dao: Dao!
  where: Bytes!
  role: Bytes!
  frozen: Boolean!
}

type Permission @entity {
  "no need to store granted as we can delete permission when revoked"
  id: ID! # where + role + who
  dao: Dao!
  where: Bytes!
  role: Role!
  who: Bytes!
  actor: Bytes!
  oracle: Bytes!
}

type Action @entity {
  id: ID!
  to: Bytes!
  value: BigInt!
  data: Bytes!
  dao: Dao!
  execResult: Bytes
}

type VaultWithdraw @entity {
  id: ID!
  dao: Dao!
  token: Bytes
  to: Bytes!
  amount: BigInt!
  reference: String!
  createdAt: BigInt!
}

type VaultDeposit @entity {
  id: ID!
  dao: Dao!
  token: Bytes!
  sender: Bytes!
  amount: BigInt!
  reference: String!
  createdAt: BigInt!
}

type Dao @entity {
  id: ID! # use address as id
  name: String!
  creator: Bytes!
  metadata: String!
  token: Bytes!
  actions: [Action!]! @derivedFrom(field: "dao")
  deposits: [VaultDeposit!]! @derivedFrom(field: "dao")
  withdraws: [VaultWithdraw!]! @derivedFrom(field: "dao")
  balances: [Balance!] @derivedFrom(field: "dao")
  roles: [Role!]! @derivedFrom(field: "dao")
  permissions: [Permission!]! @derivedFrom(field: "dao")
  packages: [DaoPackage!] @derivedFrom(field: "dao")
}
