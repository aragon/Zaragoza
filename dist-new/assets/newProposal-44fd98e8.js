import{u as $,h as E,O as D,e as R,Y as G,j as T,bJ as O,cv as Y,G as q,aM as I,ar as P,aY as J,q as e,L as k,R as Q,a_ as H,F as m,cw as j,cx as K,cs as X,cy as Z,aL as ee,aN as te,ct as se}from"./main-1e616d6f.js";import{r as S}from"./tiptap-313d156f.js";import{F as ae}from"./index-5413d03b.js";import{S as w,i as oe,a as ie}from"./index-9717678c.js";import{C as re}from"./index-5cc856d8.js";import{i as ne,a as de,D as le,C as pe,U as ce}from"./createProposal-e1ca110a.js";import{R as ue}from"./index-b5e6cc73.js";import"./osx-ethers-780b73f3.js";import"./useTokenMetadata-6398f62d.js";import"./index.es-c80844a1.js";import"./browser-9096de8d.js";import"./index-4cbd21fe.js";import"./accordionSummary-a06aa21e.js";import"./index-30af19f4.js";import"./index-93139e2c.js";import"./index-b80a0dc5.js";import"./useTokenSupply-9a8f8b12.js";import"./query-keys-5b13e665.js";import"./useResolveDaoAvatar-b536da94.js";import"./button-023419f0.js";const me=({enableTxModal:g})=>{const[p,x]=S.useState(!1),{t}=$(),{open:h}=E(),{type:o}=D(),{network:i}=R(),{address:f,isConnected:v}=G(),{data:s,isLoading:A}=T(),{data:c,isLoading:V}=O({pluginAddress:s?.plugins?.[0]?.instanceAddress,pluginType:s?.plugins?.[0]?.id}),{actions:_}=Y(),{trigger:C,control:b,getValues:r,setValue:N}=q(),{errors:n,dirtyFields:U}=I({control:b}),d=P({name:"actions"}),B=P({name:"updateFramework"}),F=P({name:"pluginSelectedVersion"}),u=o===J.OSUpdates;return S.useEffect(()=>{(async()=>{const l=await Z(d,_,n,i);x(l)})()},[d,_,n,n?.actions?.length,i]),A||V?e.jsx(k,{}):!s||!c?null:e.jsxs(ae,{wizardProcessName:t("newProposal.title"),processType:"ProposalCreation",navLabel:t("newProposal.title"),returnPath:Q(H,{network:i,dao:s.address}),children:[e.jsx(w,{wizardTitle:t(u?"update.reviewUpdates.headerTitle":"newWithdraw.defineProposal.heading"),wizardDescription:t(u?"update.reviewUpdates.headerDesc":"newWithdraw.defineProposal.description"),isNextButtonDisabled:!ne(U,n,o,B,F?.isPrepared),onNextButtonClicked:a=>{m("newProposal_nextBtn_clicked",{dao_address:s.address,step:"1_define_proposal",settings:{author_address:f,title:r("proposalTitle"),summary:r("proposalSummary"),proposal:r("proposal"),resources_list:r("links")}}),a()},children:u?e.jsx(de,{}):e.jsx(le,{})}),e.jsx(w,{wizardTitle:t("newWithdraw.setupVoting.title"),wizardDescription:t("newWithdraw.setupVoting.description"),isNextButtonDisabled:!oe(n),onNextButtonClicked:a=>{const[l,y,W,z,L,M]=r(["startDate","startTime","startUtc","endDate","endTime","endUtc"]);m("newProposal_nextBtn_clicked",{dao_address:s.address,step:"2_setup_voting",settings:{start:`${l}T${y}:00${j(W)}`,end:`${z}T${L}:00${j(M)}`}}),a()},children:e.jsx(ie,{pluginSettings:c})}),e.jsx(w,{wizardTitle:t("newProposal.configureActions.heading"),wizardDescription:t("newProposal.configureActions.description"),isNextButtonDisabled:!p,...u&&{skipStep:!0,hideWizard:!0},onNextButtonDisabledClicked:()=>{C("actions")},onNextButtonClicked:a=>{K(c)&&N("actions",X(d,c)),m("newProposal_nextBtn_clicked",{dao_address:s.address,step:"3_configure_actions",settings:{actions:d.map(l=>l.name),actions_count:d.length}}),a()},children:e.jsx(re,{})}),e.jsx(w,{wizardTitle:t("newWithdraw.reviewProposal.heading"),wizardDescription:t("newWithdraw.reviewProposal.description"),nextButtonLabel:t("labels.submitProposal"),onNextButtonClicked:()=>{v?(m("newProposal_publishBtn_clicked",{dao_address:s.address}),g()):h("wallet")},fullWidth:!0,children:e.jsx(ue,{defineProposalStepNumber:1,addActionsStepNumber:3})})]})},we={updateFramework:{os:!1,plugin:!1}},ye=()=>{const{type:g}=D(),{data:p,isLoading:x}=T(),t=g==="os-update",[h,o]=S.useState(!1),i=ee({mode:"onChange",defaultValues:{links:[{name:"",url:""}],startSwitch:"now",durationSwitch:"duration",actions:[],...t?we:{}}}),f=()=>{o(!0)};return x?e.jsx(k,{}):p?e.jsx(te,{...i,children:e.jsx(se,{daoId:p.address,children:e.jsx(pe,{showTxModal:h,setShowTxModal:o,children:e.jsx(ce,{children:e.jsx(me,{enableTxModal:f})})})})}):null};export{ye as NewProposal};
