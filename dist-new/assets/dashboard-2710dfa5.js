import{y as C,u as M,f as _,e as F,g as Z,i as ia,k as J,j as ca,m as da,q as e,L as T,aQ as I,t as m,w as E,R as h,aR as B,aS as ua,aT as pa,aU as q,az as ma,aV as ga,aW as xa,ae as ba,Y as ha,aX as G,aC as aa,aY as Q,aZ as z,a_ as Ca,a$ as fa,b0 as ya,p as Da,h as ea,b1 as va,b2 as wa,b3 as ja,b4 as Pa,b5 as ka,al as La,O as Ma,$ as Ta,b6 as Sa,b7 as Aa,b8 as Na,b9 as W,z as V,ba as Ra,bb as Ia,bc as Ea,ad as _a}from"./main-1e616d6f.js";import{r as b}from"./tiptap-313d156f.js";import{M as K}from"./index-91660b57.js";import{u as ta,P as Fa,p as Ba,C as Va}from"./governance-6b57337c.js";import{a as $a}from"./query-keys-5b13e665.js";import{u as sa}from"./useDaoVault-83014ea0.js";import{a as qa,b as Ga}from"./usePendingDao-353bf14a.js";import"./osx-ethers-780b73f3.js";import"./button-023419f0.js";import"./sectionWrappers-aaf62731.js";import"./useTokenMetadata-6398f62d.js";import"./usePollTransfersPrices-f8333826.js";const $=({daoAddressOrEns:a,pluginType:s,pluginAddress:r,horizontal:n})=>{const{t}=M(),l=_(),{network:c}=F(),{isDesktop:g}=Z(),{handleOpenModal:x}=ia(),{data:{members:i,daoToken:d,memberCount:y},isLoading:D}=J(r,s,{page:0}),{data:v}=ca(),{isDAOTokenWrapped:w,isTokenMintable:j}=da({daoToken:d,daoDetails:v}),u=s==="multisig.plugin.dao.eth",o=()=>{u?l(h(ua,{network:c,dao:a})):w?x():l(j?h(pa,{network:c,dao:a}):h(B,{network:c,dao:a}))};if(D)return e.jsx(T,{});if(i.length===0)return null;const S=i.slice(0,3);return n&&g?e.jsxs("div",{className:"flex space-x-6",children:[e.jsx("div",{className:"w-1/3",children:e.jsx(I,{icon:m.APP_MEMBERS,value:`${y} ${t("labels.members")}`,label:t(u?"explore.explorer.walletBased":"explore.explorer.tokenBased"),buttonText:t(u?"labels.manageMember":w?"community.ctaMain.wrappedLabel":j?"labels.addMember":"labels.seeCommunity"),orientation:"vertical",onClick:o})}),e.jsxs("div",{className:"w-2/3 space-y-4",children:[e.jsx(Ua,{children:e.jsx(K,{token:d,members:S})}),e.jsx(E,{variant:"tertiary",size:"lg",iconRight:m.CHEVRON_RIGHT,onClick:()=>l(h(B,{network:c,dao:a})),children:t("labels.seeAll")})]})]}):e.jsxs(Ha,{children:[e.jsx(I,{icon:m.APP_MEMBERS,value:`${y} ${t("labels.members")}`,label:t(u?"explore.explorer.walletBased":"explore.explorer.tokenBased"),buttonText:t(u?"labels.manageMember":w?"community.ctaMain.wrappedLabel":j?"labels.addMember":"labels.seeCommunity"),orientation:"vertical",onClick:o}),e.jsx(K,{token:d,members:S,isCompactMode:!0}),e.jsx(E,{variant:"tertiary",size:"lg",iconRight:m.CHEVRON_RIGHT,onClick:()=>l(h(B,{network:c,dao:a})),children:t("labels.seeAll")})]})},Ha=C.div.attrs({className:"space-y-3 xl:space-y-4"})``,Ua=C.div.attrs({className:"xl:grid xl:grid-cols-1 xl:grid-flow-row xl:gap-4"})``,Oa=q.gql`
  query TokenVotingProposalCount($pluginAddress: ID!) {
    tokenVotingPlugin(id: $pluginAddress) {
      proposalCount
    }
  }
`,Qa=async(a,s)=>{const r=await s.request({query:Oa,params:{pluginAddress:a.pluginAddress}});return Number(r.tokenVotingPlugin.proposalCount??0)},za=q.gql`
  query MultisigProposalCount($pluginAddress: ID!) {
    multisigPlugin(id: $pluginAddress) {
      proposalCount
    }
  }
`,Wa=async(a,s)=>{const r=await s.request({query:za,params:{pluginAddress:a.pluginAddress}});return Number(r.multisigPlugin.proposalCount??0)},Ka=q.gql`
  query GaslessVotingProposalCount($pluginAddress: String!) {
    plugins(where: {address: $pluginAddress}) {
      dao {
        proposalsCount
      }
    }
  }
`,Xa=async(a,s)=>{const r=await s.request({query:Ka,params:{pluginAddress:a.pluginAddress}});return Number(r.plugins[0]?.dao?.proposalsCount)||0},Ya=async(a,s)=>{switch(xa(s!=null,"fetchTotalProposalCount: client is not defined"),a.pluginType){case"multisig.plugin.dao.eth":return await Wa(a,s.graphql);case"token-voting.plugin.dao.eth":return await Qa(a,s.graphql);case ba:return await Xa(a,s.graphql);default:throw new Error("Invalid pluginType")}},Za=(a,s={})=>{const r=ma(a.pluginType);return(r==null||a.pluginAddress==null)&&(s.enabled=!1),ga($a.totalProposalCount(a),()=>Ya(a,r),s)},Ja=({proposalId:a,...s})=>{const{t:r}=M(),[{data:n},{data:t}]=fa(a);return e.jsx(ya,{...s,bannerContent:(n||t)&&Da.getValue("VITE_FEATURE_FLAG_OSX_UPDATES")==="true"?r("update.proposal.bannerTitle"):""})},N=({daoAddressOrEns:a,pluginAddress:s,pluginType:r})=>{const{t:n}=M(),t=_(),{address:l}=ha(),{network:c}=F(),{data:g,isLoading:x}=ta({daoAddressOrEns:a,pluginType:r,pluginAddress:s}),{data:i,error:d,isLoading:y,isFetched:D}=Za({pluginAddress:s,pluginType:r}),{data:v}=J(s,r,{countOnly:!0}),w=g?.pages.flat().slice(0,Fa).map(u=>Ba(u,v.memberCount,c,t,n,a,l));if(x||y)return e.jsx(T,{});if(D&&(i===0||d))return e.jsx(G,{humanIllustration:{body:"VOTING",expression:"SMILE",hairs:"MIDDLE",accessory:"EARRINGS_RHOMBUS",sunglasses:"BIG_ROUNDED"},heading:n("governance.emptyState.title"),description:aa(n)("governance.emptyState.description"),primaryButton:{label:n("TransactionModal.createProposal"),onClick:()=>t(h(z,{type:Q.Default,network:c,dao:a}))},secondaryButton:{label:n("navLinks.guide"),href:n("governance.emptyState.descriptionLinkURL"),target:"_blank",iconRight:m.LINK_EXTERNAL}});const j=i??g?.pages.flat().length;return e.jsxs(ae,{children:[e.jsx(I,{icon:m.APP_PROPOSALS,value:j?.toString()??"0",label:n("dashboard.proposalsTitle"),buttonText:n("newProposal.title"),orientation:"horizontal",onClick:()=>t(h(z,{type:Q.Default,network:c,dao:a}))}),w?.map(({id:u,...o})=>b.createElement(Ja,{...o,proposalId:u,key:u,type:"list"})),e.jsx(E,{variant:"tertiary",size:"lg",iconRight:m.CHEVRON_RIGHT,onClick:()=>t(h(Ca,{network:c,dao:a})),children:n("labels.seeAll")})]})},ae=C.div.attrs({className:"space-y-3 xl:space-y-4 w-full"})``,R=({daoAddressOrEns:a,transfers:s,totalAssetValue:r})=>{const{t:n}=M(),{open:t}=ea(),l=_(),{network:c}=F(),{handleTransferClicked:g}=va();return s.length===0?e.jsx(G,{humanIllustration:{body:"CHART",expression:"EXCITED",hairs:"BUN",object:"WALLET",objectPosition:"right"},heading:n("finance.emptyState.title"),description:aa(n)("finance.emptyState.description"),primaryButton:{label:n("finance.emptyState.buttonLabel"),onClick:()=>t("deposit")},secondaryButton:{label:n("navLinks.guide"),href:n("finance.emptyState.descriptionLinkURL"),iconRight:m.LINK_EXTERNAL,target:"_blank"}}):e.jsxs(ee,{children:[e.jsx(I,{icon:m.APP_ASSETS,value:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r),label:n("labels.treasuryValue"),buttonText:n("allTransfer.newTransfer"),orientation:"vertical",onClick:()=>t("transfer")}),s.slice(0,3).map(({tokenAmount:x,tokenSymbol:i,...d})=>e.jsx(wa,{tokenAmount:ja(x),tokenSymbol:Pa(i),...d,onClick:()=>g({tokenAmount:x,tokenSymbol:i,...d})},d.id)),e.jsx(E,{variant:"tertiary",size:"lg",iconRight:m.CHEVRON_RIGHT,onClick:()=>l(h(ka,{network:c,dao:a})),children:n("labels.seeAll")})]})},ee=C.div.attrs({className:"space-y-3 xl:space-y-4"})``,ye=()=>{const{t:a}=M(),{alert:s}=La(),{isDesktop:r}=Z(),n=_(),{network:t}=F(),{dao:l}=Ma(),{open:c}=ea(),[g,x]=b.useState(0),[i,d]=b.useState(0),y=Ta({onMutate:()=>{s(a("alert.chip.favorited"))}}),D=Sa({onMutate:()=>{s(a("alert.chip.unfavorite"),m.CLOSE)}}),{data:v,isLoading:w,isFetching:j}=Aa(),u=!j&&!y.isLoading&&!D.isLoading,{data:o,isLoading:S,isSuccess:H}=Na(l,g),k=W(o?.ensDomain)||o?.address,{data:f,isLoading:oa}=qa(l),U=Ga(()=>{n(h(_a,{network:t,dao:k})),t==="ethereum"&&c("poapClaim")}),O=b.useCallback(p=>p.address.toLowerCase()===o?.address.toLowerCase()&&p.chain===V[t].id,[o?.address,t]),A=b.useMemo(()=>o?.address&&v?!!v.some(O):!1,[O,v,o?.address]);b.useEffect(()=>{f&&H&&!o&&x(1e3)},[H,o,f]),b.useEffect(()=>{f&&o&&i===0&&(x(0),d(1),setTimeout(()=>d(2),2e3))},[o,i,f]);const na=b.useCallback(async()=>{if(i===2)try{await U.mutateAsync({network:t,daoAddress:f?.address})}catch(p){console.error(`Error removing pending dao:${f?.address}`,p)}},[i,t,f?.address,U]),ra=b.useCallback(async p=>{await navigator.clipboard.writeText(p),s(a("alert.chip.inputCopied"))},[s,a]),la=b.useCallback(async p=>{if(u)try{A?await D.mutateAsync({dao:p}):await y.mutateAsync({dao:p})}catch(L){console.error(`Error ${A?"removing DAO from list of followed DAOs":"adding DAO to list of followed DAOs"}`,L)}},[u,A,D,y]);if(oa||S||w)return e.jsx(T,{});if(f){const p={0:a("dashboard.emptyState.buildingDAO"),1:a("dashboard.emptyState.daoReady"),2:a("dashboard.emptyState.openDao")},L={0:void 0,1:m.CHECKMARK,2:void 0};return e.jsx(Va,{children:e.jsx(G,{humanIllustration:{body:"BLOCKS",expression:"CASUAL",sunglasses:"BIG_ROUNDED",hairs:"SHORT"},heading:a("dashboard.emptyState.title"),description:a("dashboard.emptyState.subtitle"),primaryButton:{label:p[i],iconLeft:L[i],onClick:na}})})}if(o&&k){const p=o?.plugins[0]?.id==="multisig.plugin.dao.eth"?a("explore.explorer.walletBased"):a("explore.explorer.tokenBased"),L=o.metadata?.links?.filter(P=>P.name!==""&&P.url!=="").map(P=>({label:P.name,href:P.url}))??[];return e.jsxs(e.Fragment,{children:[e.jsx(te,{children:e.jsx(Ra,{daoName:o.metadata.name,daoEnsName:W(o.ensDomain),daoAddress:o.address,daoAvatar:o?.metadata?.avatar,daoUrl:`app.aragon.org/#/daos/${t}/${k}`,description:o.metadata.description,created_at:Ia(o.creationDate.getTime()/1e3,"MMMM yyyy").toString(),daoChain:V[t].name,daoType:p,following:A,onCopy:ra,onFollowClick:()=>{la({address:o.address.toLowerCase(),chain:V[t].id,ensDomain:o.ensDomain,plugins:o.plugins,metadata:{name:o.metadata.name,avatar:o?.metadata?.avatar,description:o.metadata.description}})},links:L,translation:{follow:a("dao.follow.false"),following:a("dao.follow.true")}})}),r?e.jsx(se,{daoAddressOrEns:k,pluginType:o.plugins[0].id,pluginAddress:o.plugins[0].instanceAddress??""}):e.jsx(re,{daoAddressOrEns:k,pluginType:o.plugins[0].id,pluginAddress:o.plugins[0].instanceAddress??""})]})}else!f&&!o&&n(Ea,{replace:!0,state:{incorrectDao:l}});return null},te=C.div.attrs({className:"w-screen -mx-4 md:col-span-full md:w-full md:mx-0 xl:col-start-2 xl:col-span-10 md:mt-6"})``,se=({daoAddressOrEns:a,pluginType:s,pluginAddress:r})=>{const{transfers:n,totalAssetValue:t,isTokensLoading:l}=sa(),{data:c,isLoading:g}=ta({daoAddressOrEns:a,pluginType:s,pluginAddress:r}),i=(c?.pages.flat()??[]).length,d=n.length;return l||g?e.jsx(T,{}):i?e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsx(N,{daoAddressOrEns:a,pluginAddress:r,pluginType:s})}),e.jsxs(Y,{children:[e.jsx(R,{daoAddressOrEns:a,transfers:n,totalAssetValue:t}),e.jsx($,{daoAddressOrEns:a,pluginType:s,pluginAddress:r})]})]}):e.jsxs(e.Fragment,{children:[d?e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsx(N,{daoAddressOrEns:a,pluginAddress:r,pluginType:s})}),e.jsx(Y,{children:e.jsx(R,{daoAddressOrEns:a,transfers:n,totalAssetValue:t})})]}):e.jsxs(oe,{children:[e.jsx(N,{daoAddressOrEns:a,pluginAddress:r,pluginType:s}),e.jsx(R,{daoAddressOrEns:a,transfers:n,totalAssetValue:t})]}),e.jsx(ne,{children:e.jsx($,{daoAddressOrEns:a,pluginType:s,pluginAddress:r,horizontal:!0})})]})},X=C.div.attrs({className:"xl:space-y-10 xl:col-start-2 xl:col-span-6"})``,Y=C.div.attrs({className:"xl:col-start-8 xl:col-span-4 xl:space-y-6"})``,oe=C.div.attrs({className:"xl:col-start-2 xl:col-span-10 xl:flex xl:space-x-6"})``,ne=C.div.attrs({className:"xl:col-start-2 xl:col-span-10"})``,re=({daoAddressOrEns:a,pluginType:s,pluginAddress:r})=>{const{transfers:n,totalAssetValue:t,isTokensLoading:l}=sa();return l?e.jsx(T,{}):e.jsxs(le,{children:[e.jsx(N,{daoAddressOrEns:a,pluginAddress:r,pluginType:s}),e.jsx(R,{daoAddressOrEns:a,transfers:n,totalAssetValue:t}),e.jsx($,{daoAddressOrEns:a,pluginType:s,pluginAddress:r})]})},le=C.div.attrs({className:"col-span-full space-y-10"})``;export{ye as Dashboard};
