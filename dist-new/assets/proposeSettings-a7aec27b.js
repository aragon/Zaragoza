import{u as w,f as V,e as L,G as f,q as e,R as T,b9 as J,e6 as R,bW as we,J as O,N as fe,bM as Me,bK as oe,a1 as C,e7 as ae,j as X,bJ as re,bw as le,L as Y,cr as Ae,dR as de,cx as me,cu as G,aM as ke,e8 as Ee,a2 as U,a3 as se,e9 as Le}from"./main-1e616d6f.js";import{r as N}from"./tiptap-313d156f.js";import{i as Te,D as Se,C as De}from"./createProposal-e1ca110a.js";import{D as S,a as h,b as y,c as b,F as Pe}from"./index-5413d03b.js";import{S as I,a as _e}from"./index-9717678c.js";import{O as ne}from"./button-023419f0.js";import{R as Ce}from"./committee-c8ac830b.js";import{R as Ne}from"./index-b5e6cc73.js";import{u as Ve}from"./useTokenSupply-9a8f8b12.js";import"./osx-ethers-780b73f3.js";import"./index-b80a0dc5.js";import"./query-keys-5b13e665.js";import"./index-ed07b3e9.js";import"./accordionSummary-a06aa21e.js";import"./useResolveDaoAvatar-b536da94.js";const Re=({daoDetails:r,view:i})=>{const{t:s}=w(),n=V(),{network:t}=L(),{getValues:l}=f(),[d,p,a,c]=l(["daoName","daoSummary","daoLogo","daoLinks"]);let o;return i==="new"?o={name:d,summary:p,links:c?.filter(m=>m.name&&m.url)}:o={name:r?.metadata.name,summary:r?.metadata.description,links:r?.metadata.links.filter(m=>m.name&&m.url)},e.jsxs(S,{title:s("labels.review.daoMetadata"),onEditClick:()=>n(T(R,{network:t,dao:J(r.ensDomain)||r.address})),editLabel:s("settings.edit"),children:[e.jsxs(h,{children:[e.jsx(y,{children:s("labels.logo")}),e.jsx(b,{children:i==="new"?we.test(a)||a?.startsWith?.("blob")?e.jsx(O,{daoName:d,src:a}):e.jsx(O,{daoName:d,...a&&{src:URL.createObjectURL(a)}}):e.jsx(O,{daoName:r?.metadata.name||"",src:r?.metadata?.avatar})})]}),e.jsxs(h,{children:[e.jsx(y,{children:s("labels.daoName")}),e.jsx(b,{children:o.name})]}),e.jsxs(h,{children:[e.jsx(y,{children:s("labels.summary")}),e.jsx(b,{children:o.summary})]}),o.links&&o.links.length>0&&e.jsxs(h,{children:[e.jsx(y,{children:s("labels.links")}),e.jsx(b,{children:e.jsx("div",{className:"space-y-3",children:o.links.map(m=>e.jsx(fe,{label:m.name,href:m.url},m.name+m.url))})})]})]})},We=({daoAddressOrEns:r,daoToken:i,daoSettings:s,view:n})=>{const{t}=w(),l=V(),{network:d}=L(),{getValues:p}=f(),[a,c]=p(["eligibilityType","eligibilityTokenAmount"]);let o;return n==="new"?o={proposalEligibility:a==="token"?t("createDAO.review.proposalCreation",{token:c,symbol:i?.symbol}):"Anyone"}:o={proposalEligibility:s?.minProposerVotingPower?t("labels.review.tokenHoldersWithTkns",{tokenAmount:Math.ceil(Number(Me(s?.minProposerVotingPower||0,i?.decimals||18))),tokenSymbol:i?.symbol}):"Anyone"},e.jsx(S,{title:t("navLinks.members"),onEditClick:()=>l(T(R,{network:d,dao:r})),editLabel:t("settings.edit"),children:e.jsxs(h,{children:[e.jsx(y,{children:t("labels.review.proposalThreshold")}),e.jsx(b,{children:o.proposalEligibility})]})})},Ie=({daoAddressOrEns:r,daoToken:i,daoSettings:s,view:n})=>{const{t}=w(),l=V(),{network:d}=L(),{getValues:p}=f(),[a,c,o,m,j,u,x,D]=p(["minimumApproval","minimumParticipation","tokenTotalSupply","durationDays","durationHours","durationMinutes","earlyExecution","voteReplacement"]);let g;if(n==="new")g={approvalThreshold:`>${a}%`,minParticipation:`≥${c}% (≥${parseInt(c)*(o||0)/100} ${i?.symbol})`,days:m,hours:j,minutes:u,votingMode:{earlyExecution:t(x?"labels.yes":"labels.no"),voteReplacement:t(D?"labels.yes":"labels.no")}};else{const P=oe(s?.minDuration||0);g={approvalThreshold:`>${Math.round((s?.supportThreshold||0)*100)}%`,minParticipation:`≥${Math.round((s?.minParticipation||0)*100)}% (≥${(s?.minParticipation||0)*(o||0)} ${i?.symbol})`,days:P.days,hours:P.hours,minutes:P.minutes,votingMode:{earlyExecution:s?.votingMode===C.EARLY_EXECUTION?t("labels.yes"):t("labels.no"),voteReplacement:s?.votingMode===C.VOTE_REPLACEMENT?t("labels.yes"):t("labels.no")}}}return e.jsxs(S,{title:t("labels.review.governance"),onEditClick:()=>l(T(R,{network:d,dao:r})),editLabel:t("settings.edit"),children:[e.jsxs(h,{children:[e.jsx(y,{children:t("labels.minimumApprovalThreshold")}),e.jsx(b,{children:g.approvalThreshold})]}),e.jsxs(h,{children:[e.jsx(y,{children:t("labels.minimumParticipation")}),e.jsx(b,{children:g.minParticipation})]}),e.jsxs(h,{children:[e.jsx(y,{children:t("labels.minimumDuration")}),e.jsx(b,{children:t("governance.settings.preview",{days:g.days,hours:g.hours,minutes:g.minutes})})]}),e.jsxs(h,{children:[e.jsx(y,{children:t("labels.review.earlyExecution")}),e.jsx(b,{children:g.votingMode.earlyExecution})]}),e.jsxs(h,{children:[e.jsx(y,{children:t("labels.review.voteReplacement")}),e.jsx(b,{children:g.votingMode.voteReplacement})]})]})},Be=({daoAddressOrEns:r,daoSettings:i,view:s})=>{const{t:n}=w(),t=V(),{network:l}=L(),{getValues:d}=f(),p=d("eligibilityType");let a;return s==="new"?a={proposalEligibility:n(p==="anyone"?"labels.anyWallet":"labels.multisigMembers")}:a={proposalEligibility:i?.onlyListed?n("labels.multisigMembers"):n("labels.anyWallet")},e.jsx(S,{title:n("navLinks.members"),onEditClick:()=>t(T(R,{network:l,dao:r})),editLabel:n("settings.edit"),children:e.jsxs(h,{children:[e.jsx(y,{children:n("labels.proposalCreation")}),e.jsx(b,{children:a.proposalEligibility})]})})},Fe=({daoSettings:r,view:i})=>{const{t:s}=w(),{getValues:n}=f(),[t,l]=n(["multisigMinimumApprovals","multisigWallets"]);let d;return i==="new"?d={minApprovals:t,totalMembers:l.length}:d={minApprovals:r?.minApprovals,totalMembers:l.length},e.jsx(S,{title:s("labels.review.governance"),children:e.jsxs(h,{children:[e.jsx(y,{children:s("labels.minimumApproval")}),e.jsx(b,{children:`${d.minApprovals} of ${d.totalMembers} ${s("labels.authorisedWallets")}`})]})})},He=({view:r,daoSettings:i,daoAddressOrEns:s})=>{const{getValues:n}=f(),t=V(),{network:l}=L(),{t:d}=w(),{committeeMinimumApproval:p,executionExpirationMinutes:a,executionExpirationHours:c,executionExpirationDays:o,actions:m}=n(),j=N.useMemo(()=>{const x={committee:i?.executionMultisigMembers||[],committeeMinimumApproval:p,executionExpirationMinutes:a,executionExpirationHours:c,executionExpirationDays:o};return m&&m.length>0&&(x.committee=ae(m,i.executionMultisigMembers,n)),x},[m,p,i,o,c,a,n]);let u;if(r==="new")u=j;else{const{days:x,hours:D,minutes:g}=oe(i.minTallyDuration);u={committee:i?.executionMultisigMembers||[],committeeMinimumApproval:i?.minTallyApprovals||0,executionExpirationMinutes:g,executionExpirationHours:D,executionExpirationDays:x}}return e.jsx(S,{title:d("label.executionMultisig"),onEditClick:()=>t(T(R,{network:l,dao:s})),editLabel:d("settings.edit"),children:e.jsx(Ce,{...u})})},$e=()=>{const{t:r}=w(),{data:i,isLoading:s}=X(),n=i?.plugins?.[0]?.instanceAddress,t=i?.plugins?.[0]?.id,{data:l,isLoading:d}=re({pluginAddress:n,pluginType:t}),{data:p,isLoading:a}=le(n),[c,o]=N.useState("new"),m=()=>{o(x=>x==="new"?"old":"new")};if(s||d||a)return e.jsx(Y,{});if(!i||!l)return null;const u=J(i.ensDomain)||i.address;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex",children:e.jsxs(Ae,{bgWhite:!1,defaultValue:c,onChange:m,children:[e.jsx(ne,{value:"new",label:r("settings.newSettings")}),e.jsx(ne,{value:"old",label:r("settings.oldSettings")})]})}),e.jsx(Re,{daoDetails:i,view:c}),de(l)&&e.jsxs(e.Fragment,{children:[e.jsx(We,{daoAddressOrEns:u,view:c,daoSettings:l,daoToken:p}),e.jsx(Ie,{daoAddressOrEns:u,view:c,daoSettings:l,daoToken:p})]}),me(l)&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{daoAddressOrEns:u,daoSettings:l,view:c}),e.jsx(Fe,{daoSettings:l,view:c})]}),G(l)&&e.jsx(He,{daoAddressOrEns:u,daoSettings:l,view:c})]})},ze=({enableTxModal:r})=>{const{t:i}=w(),{network:s}=L(),{getValues:n,setValue:t,control:l}=f(),{errors:d,dirtyFields:p}=ke({control:l}),{data:a,isLoading:c}=X(),{data:o,isLoading:m}=re({pluginAddress:a?.plugins[0].instanceAddress,pluginType:a?.plugins[0].id}),j=a?.plugins?.[0]?.instanceAddress,{data:u}=le(j),{data:x,isLoading:D}=Ve(u?.address||""),g=N.useCallback(M=>{const[B,_]=n(["areSettingsChanged","isMetadataChanged"]);let A=M.filter(v=>{if(v.name==="modify_metadata"&&_)return v;if((v.name==="modify_token_voting_settings"||v.name==="modify_multisig_voting_settings"||v.name==="modify_gasless_voting_settings")&&B)return v;if(v.name==="add_address"||v.name==="remove_address")return v});return A=Ee(A,me(o)?o:void 0,G(o)?o:void 0),A},[n,o]),P=N.useCallback(async()=>{const[M,B,_,A,v,q,F,K,ce,ue,Q,Z,ee,pe,ie,ge,xe,he,ye,be,te]=n(["daoName","daoSummary","daoLogo","minimumApproval","multisigMinimumApprovals","minimumParticipation","eligibilityType","eligibilityTokenAmount","earlyExecution","voteReplacement","durationDays","durationHours","durationMinutes","daoLinks","tokenDecimals","executionExpirationMinutes","executionExpirationHours","executionExpirationDays","committee","committeeMinimumApproval","actions"]);let H="";if(a&&!M)return;_?.startsWith?.("blob")?H=await fetch(_).then(E=>E.blob()):H=_;const ve={name:"modify_metadata",inputs:{name:M,description:B,avatar:H,links:pe}},$=(E,z)=>E.filter(je=>je.name!==z);let W,k=[];G(o)?(k=$(te,"modify_gasless_voting_settings"),W={name:"modify_gasless_voting_settings",inputs:{token:u,totalVotingWeight:x?.raw||BigInt(0),executionMultisigMembers:ae(te,ye.map(z=>z.address),n),minTallyApprovals:be,minDuration:U(Q,Z,ee),minTallyDuration:U(he,xe,ge),minParticipation:Number(q)/100,supportThreshold:Number(A)/100,minProposerVotingPower:F==="token"?se.parseUnits(K.toString(),ie).toBigInt():BigInt(0),censusStrategy:"",daoTokenAddress:u?.address,id:j}}):de(o)?(k=$(k,"modify_token_voting_settings"),W={name:"modify_token_voting_settings",inputs:{token:u,totalVotingWeight:x?.raw||BigInt(0),minDuration:U(Q,Z,ee),supportThreshold:Number(A)/100,minParticipation:Number(q)/100,minProposerVotingPower:F==="token"?se.parseUnits(K.toString(),ie).toBigInt():void 0,votingMode:ce?C.EARLY_EXECUTION:ue?C.VOTE_REPLACEMENT:C.STANDARD}}):(k=$(k,"modify_multisig_voting_settings"),W={name:"modify_multisig_voting_settings",inputs:{minApprovals:v,onlyListed:F==="multisig"}}),t("actions",g([...k,ve,W]))},[n,a,o,u,j,t,x?.raw,g]);return c||m||D?e.jsx(Y,{}):!o||!a?null:e.jsxs(Pe,{wizardProcessName:i("newProposal.title"),navLabel:i("navLinks.settings"),returnPath:T(Le,{network:s,dao:J(a.ensDomain)||a.address}),children:[e.jsx(I,{wizardTitle:i("settings.proposeSettings"),wizardDescription:i("settings.proposeSettingsSubtitle"),onNextButtonClicked:M=>{P(),M()},children:e.jsx($e,{})}),e.jsx(I,{wizardTitle:i("newWithdraw.defineProposal.heading"),wizardDescription:i("newWithdraw.defineProposal.description"),isNextButtonDisabled:!Te(p,d),children:e.jsx(Se,{})}),e.jsx(I,{wizardTitle:i("newWithdraw.setupVoting.title"),wizardDescription:i("newWithdraw.setupVoting.description"),children:e.jsx(_e,{pluginSettings:o})}),e.jsx(I,{wizardTitle:i("newWithdraw.reviewProposal.heading"),wizardDescription:i("newWithdraw.reviewProposal.description"),nextButtonLabel:i("labels.submitProposal"),onNextButtonClicked:r,fullWidth:!0,children:e.jsx(Ne,{defineProposalStepNumber:2})})]})},oi=()=>{const[r,i]=N.useState(!1),{data:s,isLoading:n}=X(),t=()=>{i(!0)};return n?e.jsx(Y,{}):s?e.jsx(De,{showTxModal:r,setShowTxModal:i,children:e.jsx(ze,{enableTxModal:t})}):null};export{oi as ProposeSettings};
