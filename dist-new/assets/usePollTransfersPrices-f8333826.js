import{e as A,fw as P,_ as L,aV as N,fx as v,bp as M,fy as k,ey as h,fl as V,ft as l,z as T,bM as b,B as y,bb as g,eI as W}from"./main-1e616d6f.js";import{r as D}from"./tiptap-313d156f.js";import{m as $}from"./osx-ethers-780b73f3.js";async function B(t,o){return t?t.methods.getDaoTransfers(o):Promise.reject(new Error("Client not defined"))}function Q(t,o){return o.creationDate.getTime()-t.creationDate.getTime()}const q=t=>{const{network:o}=A(),{data:e,error:a,isLoading:r}=P({address:t,network:o},{enabled:!!t}),{data:n,error:d,isLoading:i}=U(t),f=a||d,s=r||i;return{data:D.useMemo(()=>x(e,n),[e,n])??[],isLoading:s,error:f}},U=(t,{sortBy:o=v.CREATED_AT,direction:e=M.DESC,limit:a=1e3}={})=>{const{client:r,network:n}=L();return N({queryKey:["Subgraph Transfers",t,n],queryFn:()=>B(r,{daoAddressOrEns:t,sortBy:o,direction:e,limit:a}),enabled:!!t})},x=(t,o)=>{const e=o?.filter(a=>a.type===k.WITHDRAW||a.type===k.DEPOSIT&&a.tokenType===h.NATIVE);return[...t??[],...e??[]].sort(Q)},H=t=>{const{network:o}=A(),e=D.useMemo(()=>R(t,o),[t,o]),a=e?.map(s=>({address:s.tokenAddress,network:o,symbol:s.tokenSymbol})),r=V(a),n=r.some(s=>s.isLoading),d=r.some(s=>s.isError),i=r.map(s=>s.data);return{data:D.useMemo(()=>{let s=0,u=0;const S=e?.map((c,p)=>{let m=0;return i[p]?.price&&(m=Number(c.tokenAmount)*Number(i[p]?.price),s=s+m,c.transferType===l.Deposit?u+=m:u-=m),{...c,usdValue:`$${m.toFixed(2)}`,tokenImgUrl:i[p]?.imgUrl??""}}),E=`$${s.toFixed(2)}`,I=!!e?.find(c=>c.transferType===l.Withdraw),w=e?.length||0,C=u>0||w>0&&!I;return{transfers:S,totalTransfersValue:E,isDaoBalancePositive:C}},[e,i]),isError:d,isLoading:n}};function R(t,o){return t.map(e=>{const a={usdValue:"",tokenImgUrl:"",id:e.transactionId,transaction:e.transactionId,transferTimestamp:e.creationDate?.getTime(),...e.tokenType==="native"?{tokenAddress:$,tokenName:T[o].nativeCurrency.name,tokenSymbol:T[o].nativeCurrency.symbol,tokenAmount:b(e.amount,T[o].nativeCurrency.decimals)}:e.tokenType===h.ERC20?{tokenName:e.token.name,tokenAddress:e.token.address,tokenSymbol:e.token.symbol,tokenAmount:b(e.amount,e.token.decimals)}:{tokenName:e.token.name,tokenAddress:e.token.address,tokenSymbol:e.token.symbol,tokenAmount:""}};return e.type===k.DEPOSIT?{...a,title:y.t("labels.deposit"),sender:e.from,transferType:l.Deposit,transferDate:e.creationDate?`${g(e.creationDate.getTime()/1e3,"relative")}`:y.t("labels.pendingTransaction")}:{...a,title:y.t("labels.withdraw"),transferType:l.Withdraw,to:e.to,proposalId:new W(e.proposalId),isPending:!1,transferDate:`${g(e.creationDate.getTime()/1e3,"relative")}`}})}export{H as a,q as u};
