import{y as u,aw as T,q as e,A as y,t as b,bm as me,w as D,bn as pe,aU as H,az as ue,e as $,aV as xe,ae as ge,bo as U,aW as q,bp as Q,bq as G,u as L,O as W,R as O,aY as be,aZ as he,br as fe,S as F,bs as Ne,bt as we,bu as je,_ as ve,f as Y,bh as Pe,J as Ce,b9 as ye,T as De,bv as ke,h as Te,Y as Ae,al as Ee,j as Me,bw as Se,aq as Oe,z as k,a3 as M,bx as $e,by as S,bz as Le,bA as _e,bB as Re,p as Ie,bC as R,bD as I,bE as V,bF as Ve,bc as Be,L as ze,bG as He,Z as Ue}from"./main-1e616d6f.js";import{r as f}from"./tiptap-313d156f.js";import{u as qe}from"./useResolveDaoAvatar-b536da94.js";import"./osx-ethers-780b73f3.js";const Qe=({address:s,ens:r,profileUrl:t,explorerUrl:o,avatarUrl:n,explorerName:d,actions:m,stats:l=[],onCopy:a})=>{const p=r||T(s),h=f.useMemo(()=>{const c=[e.jsx(y.Item,{onClick:()=>a?.(s),icon:b.COPY,children:T(s)},2),e.jsx(y.Item,{onClick:()=>a?.(`https://${t}`),icon:b.COPY,children:me(t)},3),e.jsx(Je,{},4),e.jsx(y.Item,{onClick:()=>window.open(o,"_blank"),icon:b.LINK_EXTERNAL,children:d},5)];return r&&c.unshift(e.jsx(y.Item,{onClick:()=>a?.(r),icon:b.COPY,children:r},1)),c},[s,r,d,o,a,t]);return e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{totalStats:l.length,children:e.jsxs(We,{children:[e.jsxs(Fe,{children:[e.jsx(Ke,{children:p}),e.jsxs(Ze,{children:[e.jsx(y.Container,{align:"start",customTrigger:e.jsx(D,{iconRight:b.CHEVRON_DOWN,variant:"tertiary",size:"md",className:"border border-neutral-100",children:T(s)}),children:h}),m]})]}),e.jsx(Ye,{children:e.jsx(pe,{size:"large",src:n||s})})]})}),!!l.length&&e.jsx(Xe,{total:l.length,children:l.map((c,i)=>e.jsxs(es,{total:l.length,children:[e.jsxs(ss,{children:[e.jsx(ts,{children:c.value}),c.helpText&&e.jsx("div",{children:c.helpText})]}),e.jsx(as,{children:c.description})]},`member-stat-${i}`))})]})},Ge=u.div.attrs(s=>({className:`w-full bg-neutral-0 md:rounded-xl px-4 pt-4 ${s.totalStats>2?"pb-28":s.totalStats>0?"pb-16":"pb-4"} md:px-12 ${s.totalStats>0?"md:pb-20":"md:pb-16"} md:pt-12 border border-neutral-100 space-y-6 relative`}))`
  box-shadow:
    0px 4px 8px rgba(31, 41, 51, 0.04),
    0px 0px 2px rgba(31, 41, 51, 0.06),
    0px 0px 1px rgba(31, 41, 51, 0.04);
`,We=u.div.attrs({className:"flex md:justify-between flex-col-reverse md:flex-row"})``,Fe=u.div.attrs({className:"col-span-10"})``,Ye=u.div.attrs({className:"flex mb-3 md:mb-0 md:justify-end col-span-2"})``,Ke=u.h1.attrs({className:"ft-text-2xl font-semibold text-neutral-800"})``,Ze=u.div.attrs({className:"flex justify-between items-center gap-4 mt-6"})``,Je=u.hr.attrs({className:"border-neutral-100"})``,Xe=u.div.attrs({className:"relative grid shadow-neutral border-[0.5px] border-neutral-100 rounded-xl overflow-hidden m-auto w-full md:left-10 md:m-0"})`
  grid-template-columns: repeat(${s=>s.total}, 1fr);
  transform: translateY(-50%);
  width: fit-content;

  @media screen and (max-width: 786px) {
    width: calc(100% - 32px);
    grid-template-columns: repeat(2, 1fr);
  }
`,es=u.div.attrs({className:"flex flex-col gap-0.5 border-[0.5px] border-neutral-100 p-5 text-neutral-500 bg-neutral-0"})`
  @media screen and (max-width: 786px) {
    &:last-child {
      ${s=>s.total%2!==0?"grid-column-start: 1;":""}
      ${s=>s.total%2!==0?"grid-column-end: 3;":""}
    }
  }
`,ss=u.div.attrs({className:"flex items-end gap-1"})``,ts=u.div.attrs({className:"text-neutral-800 ft-text-xl"})``,as=u.div.attrs({className:"ft-text-sm"})``,rs=H.gql`
  query TokenVotingProposals(
    $where: TokenVotingProposal_filter!
    $block: Block_height
    $direction: OrderDirection!
    $sortBy: TokenVotingProposal_orderBy!
  ) {
    tokenVotingProposals(
      where: $where
      block: $block
      orderDirection: $direction
      orderBy: $sortBy
    ) {
      id
    }
  }
`,os=H.gql`
  query MultisigProposals(
    $where: MultisigProposal_filter!
    $block: Block_height
    $direction: OrderDirection!
    $sortBy: MultisigProposal_orderBy!
  ) {
    multisigProposals(
      where: $where
      block: $block
      orderDirection: $direction
      orderBy: $sortBy
    ) {
      id
    }
  }
`,ls=async({pluginAddress:s,address:r,blockNumber:t},o)=>{q(o!=null,"fetchCreatorProposals: client is not defined");const d=(await o.methods.getMemberProposals(s,r,t??0,Q.DESC,G.CREATED_AT)).map(l=>o?.methods.getProposal(l));return(await Promise.all(d)).filter(l=>!!l)},ns=async({pluginAddress:s,address:r,pluginType:t,blockNumber:o},n)=>{q(n!=null,"fetchCreatorProposals: client is not defined");const d={where:{plugin:s.toLowerCase(),creator:r.toLowerCase()},block:o?{number:o}:null,direction:Q.DESC,sortBy:G.CREATED_AT},m=t==="multisig.plugin.dao.eth"?os:rs,l=await n.graphql.request({query:m,params:d}),p=((t==="multisig.plugin.dao.eth"?l.multisigProposals:l.tokenVotingProposals)||[]).map(c=>n?.methods.getProposal(c.id));return(await Promise.all(p)).filter(c=>!!c)},is=(s,r={})=>{const t=ue(s.pluginType),{network:o}=$(),n={network:o};return(!t||!s.pluginType)&&(r.enabled=!1),xe(U.getCreatorProposals(n,s),()=>s.pluginType===ge?ls(s,t):ns(s,t),r)},B=2,cs=6,ds=s=>{const{proposals:r=[]}=s,{t,i18n:o}=L(),{network:n}=$(),{dao:d}=W(),[m,l]=f.useState(0),a=r.slice(0,m===0?B:m*cs+B),p=a.length<r.length,h=i=>{const g=Ne[o.language];return we(i,{locale:g})},c=i=>O(je,{network:n,dao:d,id:i});return r.length===0?e.jsx(Z,{title:t("members.profile.emptyState.ProposalsCreated"),illustration:"NOT_FOUND",link:{label:t("members.profile.emptyState.CTACreateProposal"),href:O(he,{network:n,dao:d,type:be.Default})}}):e.jsx(K,{title:t("members.profile.sectionProposalsCreated",{amount:r.length}),children:e.jsxs("div",{className:"flex flex-col items-start gap-3",children:[e.jsx("div",{className:"flex w-full flex-col gap-2",children:a.map(i=>e.jsxs(fe,{className:"flex grow flex-row items-center gap-3 rounded-xl border border-neutral-100 bg-neutral-0 p-4 md:gap-4 md:px-6 md:py-5",to:c(i.id),children:[e.jsxs("div",{className:"flex grow flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"text-neutral-800 ft-text-lg",children:i.metadata.title}),e.jsx("p",{className:"line-clamp-3 text-neutral-600 ft-text-base",children:i.metadata.summary})]}),e.jsx("p",{className:"text-neutral-500 ft-text-base",children:t("members.profile.labelTimestamp",{time:h(i.creationDate)})})]}),e.jsx(F,{icon:b.CHEVRON_RIGHT,className:"shrink-0 text-neutral-300"})]},i.id))}),p&&e.jsx(D,{variant:"tertiary",size:"md",className:"border-neutral-100",iconRight:b.CHEVRON_DOWN,onClick:()=>l(i=>i+1),children:t("members.profile.labelViewMore")})]})})},ms=s=>{const{address:r,memberAddress:t,subdomain:o,metadata:n,network:d}=s,{client:m}=ve(),l=Y(),a=Pe(),[p,h]=f.useState({name:"",description:"",avatar:""}),{avatar:c}=qe(p.avatar),i={address:t,network:d},g=(w,P)=>{const v=U.getMemberDAOs(i);a.invalidateQueries(v),l(O(De,{network:P,dao:w,user:t}))};f.useEffect(()=>{async function w(){if(!n||!m)return null;const P=ke(n),v=await m?.ipfs.fetchString(P),A=JSON.parse(v);h(A)}w()},[m,n]);const N=p?p.name||"-":"No name found";return e.jsxs("a",{className:"flex flex-row items-center justify-between gap-3 cursor-pointer rounded-xl border border-neutral-100 bg-neutral-0 px-4 py-3 md:gap-4 md:px-6 md:py-3.5",onClick:()=>g(r,d),children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"mt-1",children:e.jsx(Ce,{size:"small",src:c,daoName:N})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(ps,{children:N}),e.jsx(us,{children:ye(o)||T(r)})]})]}),e.jsx(F,{icon:b.CHEVRON_RIGHT})]})},ps=u.span.attrs({className:"ft-text-lg text-neutral-800"})``,us=u.span.attrs({className:"ft-text-base text-neutral-500"})``,z=3,xs=6,gs=({daos:s,memberAddress:r})=>{const{t}=L(),[o,n]=f.useState(0),d=s?.slice(0,o===0?z:o*xs+z),m=d&&s?d?.length<s?.length:!1;return s?.length===0?e.jsx(Z,{title:t("members.profile.emptyState.Memberships"),illustration:"USERS"}):e.jsx(K,{title:t("members.profile.sectionMemberhsips",{amount:s?.length}),children:e.jsxs("div",{className:"flex flex-col items-start gap-3",children:[e.jsx("div",{className:"flex w-full flex-col gap-2",children:d?.map((l,a)=>e.jsx(ms,{address:l.address,subdomain:l.subdomain,metadata:l.metadata,network:l.network,memberAddress:r},a))}),m&&e.jsx(D,{variant:"tertiary",size:"md",className:"border-neutral-100",iconRight:b.CHEVRON_DOWN,onClick:()=>n(l=>l+1),children:t("members.profile.labelViewMore")})]})})},js=()=>{const{t:s}=L(),r=Y(),{open:t}=Te(),{network:o}=$(),{address:n,isConnected:d}=Ae(),{alert:m}=Ee(),{dao:l,user:a}=W(),{data:p,isLoading:h}=Me(),c=p?.plugins[0].id,i=p?.plugins[0].instanceAddress,{data:g}=Se(i??""),N=c==="token-voting.plugin.dao.eth",{data:w}=Oe({address:a,chainId:k[o].id,enabled:!!a&&M.isAddress(a)}),{data:P,isError:v}=$e({name:a,chainId:k[o].id,enabled:!!a&&S(a)}),{data:A}=Le({name:w||a,enabled:!!w||!!a&&S(a)}),x=(M.isAddress(a||"")?a:P)||"",J=(S(a||"")?a:w)||"",X=x?.toLowerCase()===n?.toLowerCase(),ee=k[o].explorer+"address/"+x,se=k[o].explorerName,{data:j,isLoading:te}=_e({address:x,pluginAddress:i},{enabled:x!=null&&i!=null}),{data:E=[],isLoading:ae}=is({address:x,pluginAddress:i,pluginType:c},{enabled:!!x&&!!p&&!!i}),{data:re}=Re({address:x?.toLowerCase(),pluginType:c,daoAddress:p?.address},{enabled:!!x&&!!p}),oe=!!j?.delegators?.find(C=>C.address.toLowerCase()===n?.toLowerCase()),_=d&&!X&&N&&Ie.getValue("VITE_FEATURE_FLAG_DELEGATION")==="true",le=f.useMemo(()=>{if(!N)return[{value:E.length,description:s("members.profile.labelProposalCreated")}];if(!g)return[];const C=R(j?.votingPower??0n,g.decimals),ce=R(j?.balance??0n,g.decimals),de=j?.delegators?.length||0;return[{value:I.formatNumber(C,{format:V.TOKEN_AMOUNT_SHORT}),description:s("members.profile.labelVotingPower"),helpText:g.symbol},{value:I.formatNumber(ce,{format:V.TOKEN_AMOUNT_SHORT}),description:s("members.profile.labelTokenBalance"),helpText:g.symbol},{value:de,description:s("members.profile.labelDelegationsReceived")}]},[j?.balance,j?.delegators?.length,j?.votingPower,g,N,E?.length,s]),ne=h||!x||ae||_&&te,ie=f.useCallback(async C=>{await navigator.clipboard.writeText(C),m(s("alert.chip.inputCopied"))},[m,s]);return f.useEffect(()=>{a&&!Ve(a)&&(!M.isAddress(a)||v)&&r(Be,{replace:!0})},[v,r,a]),ne?e.jsx(ze,{}):e.jsxs(bs,{children:[e.jsx(Qe,{ens:J,address:x,profileUrl:`app.aragon.org/#/daos/${o}/${l}/members/${a}`,explorerUrl:ee,explorerName:se,avatarUrl:A,onCopy:ie,stats:le,actions:_&&e.jsx(D,{variant:"primary",size:"md",onClick:()=>t("delegateVoting",{delegate:x}),children:s(oe?"members.profile.headerCTAchangeDelegation":"members.profile.headerCTAdelegateTo")})}),e.jsxs("div",{className:"flex flex-col gap-16 px-4 md:flex-row md:px-0",children:[e.jsx("div",{className:"flex grow flex-col gap-10",children:e.jsx(ds,{proposals:E})}),e.jsx("div",{className:"flex w-full grow flex-col md:max-w-[400px]",children:e.jsx(gs,{daos:re,memberAddress:x})})]})]})},bs=u.div.attrs({className:"w-screen -mx-4 md:col-span-full md:w-full md:mx-0 xl:col-start-2 xl:col-span-10 md:mt-6"})``,K=s=>{const{title:r,children:t}=s;return e.jsxs("div",{className:"flex grow flex-col gap-4",children:[e.jsx("p",{className:"font-normal text-neutral-800 ft-text-xl",children:r}),t]})},Z=s=>{const{title:r,illustration:t,link:o}=s,n=He(o?.href||"");return e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 rounded-xl border border-neutral-100 bg-neutral-0 px-6 py-5",children:[e.jsxs("div",{className:"flex grow flex-col items-start gap-4",children:[e.jsx("p",{className:"text-base font-semibold leading-tight md:text-lg",children:r}),o&&e.jsx(D,{variant:"tertiary",size:"sm",href:n,className:"md:hidden",children:o.label})]}),e.jsx("div",{className:"rounded-full bg-neutral-50 p-2",children:e.jsx(Ue,{object:t,className:"h-16 w-16 md:h-20 md:w-20"})})]})};export{js as DaoMember,Z as EmptyMemberSection,K as MemberSection};
