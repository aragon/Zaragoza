import{y as g,u as D,q as e,aG as K,bO as Q,at as U,G as O,ar as R,as as $,I as F,dz as V,al as _,am as Y,au as J,ao as B,an as X,A as N,w as L,t as S,cv as Z,e as ee,j as se,ap as te,z as le}from"./main-1e616d6f.js";import{r as p}from"./tiptap-313d156f.js";import{b as ae,c as re}from"./accordionSummary-a06aa21e.js";const ne=({max:s,min:n,...r})=>{const{t:u}=D(),l=Number(r.value);return e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(ue,{children:e.jsx(K,{...r,max:s,min:n,disableIncrement:s===l,disableDecrement:n===l})}),e.jsx(pe,{children:e.jsxs(oe,{children:[e.jsx(Q,{value:(l<=s?l:s)/s*100}),e.jsxs(de,{children:[e.jsx(ce,{style:{flexBasis:`${(l<=s?l:s)/s*100}%`},children:l<=s?l:s}),e.jsx(me,{children:u("createDAO.step4.minApprovalAddressCount",{count:s})})]})]})})]}),r.error&&e.jsx(U,{...r.error})]})},ie=g.div.attrs({className:"flex flex-col xl:flex-row items-center p-4 pt-8 xl:p-6 gap-x-6 gap-y-8 rounded-xl bg-neutral-0"})``,oe=g.div.attrs({className:"flex relative flex-1 items-center"})``,de=g.div.attrs({className:"flex absolute whitespace-nowrap -top-5 justify-between space-x-1 w-full text-sm leading-normal "})``,ce=g.p.attrs({className:"font-semibold text-right text-primary-500"})``,me=g.p.attrs({className:"text-neutral-600 ft-text-sm"})``,ue=g.div.attrs({className:"order-2 xl:order-1 w-full xl:w-1/4"})``,pe=g.div.attrs({className:"flex flex-1 xl:order-2 items-center w-full"})``,he=1,we=({isSettingPage:s})=>{const{t:n}=D(),{control:r,clearErrors:u,setValue:l,trigger:h}=O(),[t]=R({name:["multisigWallets"],control:r}),f=p.useCallback(()=>{const a=Math.ceil(t.length/2);return t.length%2?a:a+1},[t.length]),i=a=>a>t.length?n("errors.minimumApproval.exceedMaxThreshold"):a<=0?n("errors.required.minApproval"):!0,W=(a,b)=>{const o=Number(a.target.value);o>t.length?setTimeout(()=>{u("multisigMinimumApprovals"),l("multisigMinimumApprovals",t.length),h("multisigMinimumApprovals")},V):o<=0?setTimeout(()=>{u("multisigMinimumApprovals"),l("multisigMinimumApprovals",1),h("multisigMinimumApprovals")},V):a.target.value=o.toString(),b(a)};return p.useEffect(()=>{s||l("multisigMinimumApprovals",f())},[f,s,l]),e.jsxs(e.Fragment,{children:[e.jsx($,{label:n("labels.minimumApproval"),helpText:n("createDAO.step4.minimumApprovalSubtitle")}),e.jsx(F,{name:"multisigMinimumApprovals",control:r,defaultValue:f,rules:{validate:i},render:({field:{onBlur:a,onChange:b,value:o,name:x},fieldState:{error:j}})=>e.jsx(e.Fragment,{children:e.jsx(ne,{name:x,value:o,min:he,max:t.length,onBlur:a,onChange:k=>W(k,b),error:ge(o,t.length,n,j)})})})]})};function ge(s,n,r,u){if(u?.message)return{message:u.message,variant:"critical"};const l=Number(s);return l<=n/2&&l>0?{message:r("createDAO.step4.alerts.minority"),variant:"warning"}:l>0&&l<n*.75?{message:r("createDAO.step4.alerts.majority"),variant:"success"}:{message:r("createDAO.step4.alerts.absoluteMajority"),variant:"warning"}}const be=({actionIndex:s,isRemove:n=!1,fieldIndex:r,dropdownItems:u,onBlur:l,onClearRow:h,currentDaoMembers:t,customRowValidator:f})=>{const{t:i}=D(),{alert:W}=_(),{api:a}=Y(),{control:b}=O(),o=`actions.${s}.inputs.memberWallets`,x=R({name:o,control:b}),j=p.useCallback(()=>{W(i("alert.chip.inputCleared")),h?.()},[W,h,i]),k=p.useCallback(async({address:A,ensName:C},y)=>{const v=new B(a,A,C);let m=await J(new B(a,A,C),i("errors.required.walletAddress"),i);return t?.some(d=>d.address.toLowerCase()===v.address?.toLowerCase())&&(m=i("errors.duplicateAddressOnCurrentMembersList")),x?.some(({address:d,ensName:w},E)=>(d===v.address||w===v.ensName)&&E!==y)&&(m=i("errors.duplicateAddress")),m},[t,x,a,i]);return e.jsx(F,{name:`${o}.${r}`,defaultValue:{address:"",ensName:""},control:b,rules:{validate:A=>f?f(A,x,r):k(A,r)},render:({field:{onChange:A,ref:C,value:y},fieldState:{error:v}})=>e.jsxs(xe,{children:[e.jsx(Ae,{children:e.jsx(X,{state:v&&"critical",disabled:n,value:y,onBlur:l,onChange:A,error:v?.message,resolveLabels:"onBlur",ref:C,onClearButtonClick:j})}),e.jsx(N.Container,{disabled:x?.length===1&&!n,align:"start",customTrigger:e.jsx(L,{size:"lg",variant:"tertiary",iconLeft:S.DOTS_VERTICAL,"data-testid":"trigger"}),children:u.map(m=>e.jsx(N.Item,{onClick:()=>m.callback(r),children:m.label},m.label))})]})})},xe=g.div.attrs(()=>({className:"flex gap-4 items-start"}))``,Ae=g.div.attrs(()=>({className:"flex flex-col gap-2 flex-1"}))``,Ne=({actionIndex:s,useCustomHeader:n=!1,currentDaoMembers:r,allowRemove:u=!0,customRowValidator:l,borderless:h})=>{const{t}=D(),{removeAction:f}=Z(),{alert:i}=_(),{network:W}=ee(),{data:a}=se(),{control:b,trigger:o,setValue:x}=O(),j=`actions.${s}.inputs.memberWallets`,k=R({name:j,control:b}),{fields:A,update:C,replace:y,append:v,remove:m}=te({control:b,name:j}),d=A.map((c,M)=>({...c,...k&&{...k[M]}}));p.useEffect(()=>{d.length===0&&y({address:"",ensName:""}),x(`actions.${s}.name`,"add_address")},[s,y,d.length,x]);const w=p.useCallback(()=>{d.length>1&&setTimeout(()=>{o(j)},50)},[d.length,j,o]),E=p.useCallback(()=>{v({address:"",ensName:""}),setTimeout(()=>{o(`actions.${s}.inputs.memberWallets.${d.length}`)},50)},[s,v,d.length,o]),z=p.useCallback(c=>{m(c),w()},[m,w]),P=p.useCallback(()=>{m(),i(t("alert.chip.removedAllAddresses"))},[i,m,t]),q=p.useCallback(()=>{w()},[w]),I=p.useCallback(()=>{d.forEach((c,M)=>{C(M,{address:"",ensName:""})}),i(t("alert.chip.resetAction"))},[i,d,t,C]),G=[{label:t("labels.whitelistWallets.deleteEntry"),callback:c=>{z(c),i(t("alert.chip.removedAddress"))}}],H=(()=>{const c=[e.jsx(N.Item,{onClick:I,children:t("labels.resetAction")},0)];return u&&c.push(e.jsx(N.Item,{onClick:()=>{f(s),i(t("alert.chip.removedAction"))},children:t("labels.removeEntireAction")},1)),c})();return e.jsxs(ae,{verified:!0,type:"action-builder",methodName:t("labels.addWallets"),smartContractName:`Multisig v${a?.plugins[0].release}.${a?.plugins[0].build}`,smartContractAddress:a?.plugins[0].instanceAddress,blockExplorerLink:a?.plugins[0].instanceAddress?`${le[W].explorer}address/${a?.plugins[0].instanceAddress}`:void 0,methodDescription:t("labels.addWalletsDescription"),dropdownItems:H,customHeader:n&&e.jsx(ve,{}),children:[e.jsx(T,{className:`hidden xl:block ${n?"rounded-t-xl border-t pb-3 pt-6":"py-3"}`,hideBorder:h,children:e.jsx($,{label:t("labels.whitelistWallets.address")})}),d.map((c,M)=>e.jsxs(T,{className:`${M===0&&"rounded-t-xl border-t xl:rounded-[0px] xl:border-t-0"}`,hideBorder:h,children:[e.jsx("div",{className:"mb-1 xl:mb-0 xl:hidden",children:e.jsx($,{label:t("labels.whitelistWallets.address")})}),e.jsx(be,{actionIndex:s,fieldIndex:M,dropdownItems:G,onClearRow:q,onBlur:w,currentDaoMembers:r,customRowValidator:l})]},c.id)),e.jsxs(T,{className:"flex justify-between",hideBorder:h,children:[e.jsx(L,{variant:"tertiary",size:"lg",onClick:E,children:t("labels.addWallet")}),e.jsxs(N.Container,{align:"start",customTrigger:e.jsx(L,{size:"lg",variant:"tertiary",iconLeft:S.DOTS_VERTICAL,"data-testid":"trigger"}),children:[e.jsx(N.Item,{onClick:I,children:t("labels.whitelistWallets.resetAllEntries")}),e.jsx(N.Item,{onClick:P,children:t("labels.whitelistWallets.deleteAllEntries")})]})]}),e.jsx(re,{total:d.filter(c=>c.address).length,borderless:h})]})},ve=()=>{const{t:s}=D();return e.jsxs("div",{className:"mb-3 space-y-1",children:[e.jsx("p",{className:"text-base font-semibold leading-normal text-neutral-800",children:s("labels.addWallets")}),e.jsx("p",{className:"text-sm leading-normal text-neutral-600",children:s("labels.addWalletsDescription")})]})},T=g.div.attrs(s=>({className:`px-6 py-3 bg-neutral-0 ${s.hideBorder?"border-t-0 ":"border border-neutral-100 border-t-0"}`}))``;export{Ne as A,T as F,ne as M,we as a,be as b,ge as g};
