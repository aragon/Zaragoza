import{u as k,e as j,Y as G,f as O,k as q,q as a,ax as z,z as M,F as R,R as B,bu as Q,ci as W,cj as A,ck as x,cl as S,cm as $,cn as H,aF as E,co as K,a$ as X,b0 as Y,p as U,bq as Z,bp as J,az as ee,bh as te,bo as C,c5 as se,cp as F,aW as ae,cq as ne,h as oe,j as re,L as ie,r as le,x as ce,aC as de,t as D,S as ue,cr as ge,b9 as N,w as pe,y as w,aY as me,aZ as ve}from"./main-1e616d6f.js";import{r as T}from"./tiptap-313d156f.js";import{O as b}from"./button-023419f0.js";import{P as I}from"./sectionWrappers-aaf62731.js";function Pe(e){return e?"approvals"in e:!1}const fe=({proposalId:e,...n})=>{const{t}=k(),[{data:l},{data:s}]=X(e);return a.jsx(Y,{...n,bannerContent:(l||s)&&U.getValue("VITE_FEATURE_FLAG_OSX_UPDATES")==="true"?t("update.proposal.bannerTitle"):""})},be=({proposals:e,daoAddressOrEns:n,pluginAddress:t,pluginType:l,isLoading:s})=>{const{t:c}=k(),{network:r}=j(),{address:p}=G(),g=O(),{data:o,isLoading:d}=q(t,l,{countOnly:!0}),u=T.useMemo(()=>e.map(i=>he(i,o.memberCount,r,g,c,n,p)),[e,o.memberCount,r,g,c,n,p]);return s||d?a.jsx("div",{className:"flex h-14 items-center justify-center",children:a.jsx(z,{size:"xl",variant:"primary"})}):u.length===0?a.jsx("div",{className:"flex h-14 items-center justify-center text-neutral-600",children:a.jsx("p",{"data-testid":"proposalList",children:c("governance.noProposals")})}):a.jsx("div",{className:"space-y-6","data-testid":"proposalList",children:u.map(({id:i,...m})=>T.createElement(fe,{...m,proposalId:i,key:i}))})};function ye(e,n){return n===0?0:Math.round(e/n*100)}function he(e,n,t,l,s,c,r){const p=r&&e.creatorAddress.toLowerCase()===r.toLowerCase()?s("labels.you"):e.creatorAddress,g={id:e.id,title:e.metadata.title,description:e.metadata.summary,explorer:M[t].explorer,publisherAddress:e.creatorAddress,publisherDisplayName:p,publishLabel:s("governance.proposals.publishedBy"),process:e.status.toLowerCase(),onClick:()=>{R("governance_viewProposal_clicked",{proposal_id:e.id,dao_address:e.dao.address}),l(B(Q,{network:t,dao:c,id:e.id}))}};if(W(e)){let o;e.status===A.SUCCEEDED?o=`${s("labels.approvals")} ${x(A.ACTIVE,e.endDate,e.tallyEndDate)}`:o=x(e.status,e.startDate,e.endDate);const d={voteTitle:s("governance.proposals.voteTitle"),stateLabel:S,alertMessage:o,title:e.metadata.title,description:e.metadata.description};return{...g,...d}}else if($(e)){const o={voteTitle:s("governance.proposals.voteTitle"),stateLabel:S,alertMessage:x(e.status,e.startDate,e.endDate)},d={...g,...o};if(e.status.toLowerCase()==="active"){const u=H(e.result,e.token.decimals);let i;const m=E(e.result.no.toString()),v=E(e.result.yes.toString()),P=E(e.result.abstain.toString()),f=v.add(m);if(f.gt(0)?v.div(f).gt(e.settings.supportThreshold)?i={...u.yes,option:"yes"}:i=m.gte(P)?{...u.no,option:"no"}:{...u.abstain,option:"abstain"}:P.gt(0)&&(i={...u.abstain,option:"abstain"}),i){const _={yes:s("votingTerminal.yes"),no:s("votingTerminal.no"),abstain:s("votingTerminal.abstain")},y=e.votes?.some(L=>L.address.toLowerCase()===r?.toLowerCase())?s("governance.proposals.alert.voted"):void 0,h={voteProgress:i.percentage,voteLabel:_[i.option],tokenSymbol:e.token.symbol,tokenAmount:i.value.toString(),votedAlertLabel:y};return{...d,...h}}return d}else return d}else if(Pe(e)){const o={process:e.status===A.SUCCEEDED?s("votingTerminal.status.approved").toLowerCase():g.process,voteTitle:s("votingTerminal.approvedBy"),stateLabel:S,alertMessage:x(e.status,e.startDate,e.endDate)};if(e.status.toLowerCase()==="active"){const u={votedAlertLabel:e.approvals?.some(i=>K(i).toLowerCase()===r?.toLowerCase())?s("governance.proposals.alert.voted"):void 0,voteProgress:ye(e.approvals.length,n),winningOptionValue:`${e.approvals.length} ${s("votingTerminal.ofMemberCount",{memberCount:n})}`};return{...g,...o,...u}}else return{...g,...o}}else throw Error("invalid proposal type")}const xe=6,Le={limit:xe,skip:0,sortBy:Z.CREATED_AT,direction:J.DESC};async function Ae(e,n){return ae(!!n,"fetchProposalsAsync: client is not defined"),await n.methods.getProposals(e)}const Se=(e,n={})=>{const t={...Le,...e},l=ee(t.pluginType),s=te(),{network:c}=j(),r=M[c].id;(l==null||t.daoAddressOrEns==null||t.pluginAddress==null)&&(n.enabled=!1);const p=s.getQueryData(C.localProposals(t.status))??new Set,g=o=>ne(r,o);return se({...n,queryKey:C.proposals(t),queryFn:async o=>{const d=o.pageParam?o.pageParam*t.limit-p.size:t.skip,u=await Ae({...t,skip:d},l),i=new Set(u.map(f=>f.id)),m=F.getProposalsByPluginAddress(r,t.pluginAddress),v=Ee(i,m,r),P=Ce(v,i,p,t.status);return s.setQueryData(C.localProposals(t.status),p),[...P,...u].slice(0,t.limit)},getNextPageParam:(o,d)=>{if(o.length===t.limit)return d.length},select:n.select??g})};function Ee(e,n,t){return n.filter(l=>e.has(l.id)?(F.removeProposal(t,l.id),!1):!0)}function Ce(e,n,t,l){const s=[];for(const c of e)!n.has(c.id)&&!t.has(c.id)&&(c.status===l||l==null)&&(s.push(c),t.add(c.id));return s}const De=()=>{const{t:e}=k(),n=O(),{open:t}=oe(),{network:l}=j(),[s,c]=T.useState("All"),{data:r,isLoading:p}=re(),g=r?.plugins[0].id,o=r?.plugins[0].instanceAddress,{data:d,fetchNextPage:u,hasNextPage:i,isFetchingNextPage:m,isFetched:v,isLoading:P}=Se({daoAddressOrEns:r?.address,pluginType:g,pluginAddress:o??"",status:s!=="All"?s:void 0}),f=v&&d?.pages[0].length===0&&s==="All",y=g==="token-voting.plugin.dao.eth"&&U.getValue("VITE_FEATURE_FLAG_DELEGATION")==="true",h=()=>{R("governance_newProposalBtn_clicked",{dao_address:r?.address}),n(B(ve,{type:me.Default,network:l,dao:N(r?.ensDomain)||r?.address}))},L=()=>{m||u()};return p?a.jsx(ie,{}):f?a.jsx(I,{includeHeader:!1,children:a.jsx(le,{className:"mt-6 flex items-center justify-center md:mt-10",children:a.jsx(ce,{heading:e("governance.emptyState.title"),description:de(e)("governance.emptyState.description"),humanIllustration:{body:"VOTING",expression:"SMILE",hairs:"MIDDLE",accessory:"EARRINGS_RHOMBUS",sunglasses:"BIG_ROUNDED"},primaryButton:{label:e("TransactionModal.createProposal"),onClick:h},secondaryButton:y?{label:e("governance.actionSecondary"),onClick:()=>t("delegateVoting")}:{label:e("navLinks.guide"),href:e("governance.emptyState.descriptionLinkURL"),target:"_blank",iconRight:D.LINK_EXTERNAL}})})}):a.jsxs(I,{title:"Proposals",primaryBtnProps:{label:e("governance.action"),iconLeft:a.jsx(ue,{icon:D.PLUS}),onClick:h},secondaryBtnProps:y?{label:e("governance.actionSecondary"),onClick:()=>t("delegateVoting")}:void 0,children:[a.jsx(ke,{children:a.jsxs(ge,{bgWhite:!0,defaultValue:s,onChange:V=>{c(V)},children:[a.jsx(b,{value:"All",label:"All"}),a.jsx(b,{value:"Pending",label:"Pending"}),a.jsx(b,{value:"Active",label:"Active"}),a.jsx(b,{value:"Succeeded",label:"Succeeded"}),a.jsx(b,{value:"Executed",label:"Executed"}),a.jsx(b,{value:"Defeated",label:"Defeated"})]})}),a.jsx(je,{children:a.jsx(be,{daoAddressOrEns:N(r?.ensDomain)||r?.address,proposals:d?.pages.flat()??[],pluginAddress:o,pluginType:g,isLoading:P})}),i&&a.jsx("div",{className:"mt-6",children:a.jsx(pe,{isLoading:m,iconRight:m?void 0:D.CHEVRON_DOWN,variant:"tertiary",size:"md",onClick:L,children:e("explore.explorer.showMore")})})]})},Te=w.div.attrs({className:"col-span-full xl:col-start-3 xl:col-end-11"})``,ke=w.div.attrs({className:"flex overflow-auto mt-6 xl:mt-16"})`
  scrollbar-width: none;

  ::-webkit-scrollbar {
    width: 0px;
    background: transparent;
  }
`,je=w.div.attrs({className:"mt-6"})``,Oe=Object.freeze(Object.defineProperty({__proto__:null,Container:Te,Governance:De},Symbol.toStringTag,{value:"Module"}));export{Te as C,xe as P,Oe as g,he as p,Se as u};
