import{r as v}from"./tiptap-313d156f.js";import{e as V,fl as A,bM as p,fm as h,j as B,fn as M,fo as y}from"./main-1e616d6f.js";import{a as I,u as E}from"./useTokenMetadata-6398f62d.js";import{u as N,a as w}from"./usePollTransfersPrices-f8333826.js";const x=(t,n={filter:h.day,interval:3e5})=>{const{network:u}=V(),m=t.map(({metadata:a})=>({address:a.id,network:u,symbol:a.symbol})),l=A(m,{refetchInterval:n.interval}),o=l.some(a=>a.isLoading),g=l.some(a=>a.isError),s=l.map(a=>a.data);return{data:v.useMemo(()=>{let a=0,c;return{tokens:t.map((i,d)=>{const r=s[d];return r?.price==null?i:(c=r.price*Number(p(i.balance,i.metadata.decimals)),a+=c,{...i,marketData:{price:r.price,balanceValue:c,percentageChangedDuringInterval:r.priceChange[n.filter]}})}),totalAssetValue:a,totalAssetChange:0}},[s,n.filter,t]),isError:g,isLoading:o}},W=(t={filter:h.day,interval:3e5})=>{const{data:n,isLoading:u}=B(),{data:m,isLoading:l}=I(n?.address??""),{data:o,isLoading:g}=E(m),{data:s,isLoading:k}=x(o,t),{data:a,isLoading:c}=N(n?.address??""),{data:f,isLoading:i}=w(a),d=u||c||i,r=u||l||g||k,L=r||d;return{tokens:v.useMemo(()=>{if(s?.tokens?.length===0)return o;const T=(e,D)=>Number(p(e,D)),P=M(a,o,y(t.filter));return s.totalAssetChange=0,s.tokens.forEach(e=>{if(e.marketData){const D=P[e.metadata.id]?.balance||BigInt(0),b=e.marketData.price/(1+e.marketData.percentageChangedDuringInterval/100),C=T(D,e.metadata.decimals)*b;e.marketData.valueChangeDuringInterval=e.marketData.balanceValue-C,s.totalAssetChange+=e.marketData.valueChangeDuringInterval}}),s.tokens.map(e=>({...e,...e.marketData?.balanceValue!==void 0&&s.totalAssetValue>0?{treasurySharePercentage:e.marketData.balanceValue/s?.totalAssetValue*100}:{}}))},[t.filter,s,o,a]),totalAssetValue:s.totalAssetValue,totalAssetChange:s.totalAssetChange,transfers:f.transfers,isDaoBalancePositive:f.isDaoBalancePositive,isTokensLoading:L,isTransfersLoading:d,isCumulativeStatsLoading:r}};export{W as u};
