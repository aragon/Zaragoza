import{fq as M,fr as z,fs as V,y as A,u as J,h as K,aL as ae,ez as E,ar as se,b9 as ne,ft as R,q as e,Q as re,aX as oe,as as q,I as P,eJ as H,w as O,t as I,at as _,b1 as le,j as ie,L as ce,S as de,cr as ue,A as $,dF as Q,bs as fe}from"./main-1e616d6f.js";import{r as v}from"./tiptap-313d156f.js";import{O as B}from"./button-023419f0.js";import{T as W}from"./index-7a995b24.js";import{P as me,T as U}from"./sectionWrappers-aaf62731.js";import{u as pe,a as he}from"./usePollTransfersPrices-f8333826.js";import{c as L}from"./osx-ethers-780b73f3.js";function X(c,o){M(1,arguments);var n=o||{},l=n.locale,x=l&&l.options&&l.options.weekStartsOn,p=x==null?0:z(x),a=n.weekStartsOn==null?p:z(n.weekStartsOn);if(!(a>=0&&a<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=V(c),d=f.getDay(),t=(d<a?7:0)+d-a;return f.setDate(f.getDate()-t),f.setHours(0,0,0,0),f}function ve(c,o,n){M(2,arguments);var l=X(c,n),x=X(o,n);return l.getTime()===x.getTime()}function xe(c,o){M(2,arguments);var n=V(c),l=V(o);return n.getFullYear()===l.getFullYear()&&n.getMonth()===l.getMonth()}function we(c){return M(1,arguments),xe(Date.now(),c)}function je(c,o){return M(1,arguments),ve(c,Date.now(),o)}function ye(c){const{data:o}=pe(c),{data:{transfers:n,totalTransfersValue:l}}=he(o);return{data:v.useMemo(()=>{const p=[],a=[],f=[];return n.forEach(d=>{const t=d.transferTimestamp;je(t)?p.push(d):we(t)?a.push(d):f.push(d)}),{week:p,month:a,year:f}},[n]),totalTransfers:l,isLoading:!1}}var Z={exports:{}};(function(c,o){(function(n,l){l()})(L,function(){function n(t,r){return typeof r>"u"?r={autoBom:!1}:typeof r!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\uFEFF",t],{type:t.type}):t}function l(t,r,u){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="blob",s.onload=function(){d(s.response,r,u)},s.onerror=function(){console.error("could not download file")},s.send()}function x(t){var r=new XMLHttpRequest;r.open("HEAD",t,!1);try{r.send()}catch{}return 200<=r.status&&299>=r.status}function p(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof L=="object"&&L.global===L?L:void 0,f=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(t,r,u){var s=a.URL||a.webkitURL,i=document.createElement("a");r=r||t.name||"download",i.download=r,i.rel="noopener",typeof t=="string"?(i.href=t,i.origin===location.origin?p(i):x(i.href)?l(t,r,u):p(i,i.target="_blank")):(i.href=s.createObjectURL(t),setTimeout(function(){s.revokeObjectURL(i.href)},4e4),setTimeout(function(){p(i)},0))}:"msSaveOrOpenBlob"in navigator?function(t,r,u){if(r=r||t.name||"download",typeof t!="string")navigator.msSaveOrOpenBlob(n(t,u),r);else if(x(t))l(t,r,u);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){p(s)})}}:function(t,r,u,s){if(s=s||open("","_blank"),s&&(s.document.title=s.document.body.innerText="downloading..."),typeof t=="string")return l(t,r,u);var i=t.type==="application/octet-stream",y=/constructor/i.test(a.HTMLElement)||a.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||i&&y||f)&&typeof FileReader<"u"){var D=new FileReader;D.onloadend=function(){var T=D.result;T=g?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=T:location=T,s=null},D.readAsDataURL(t)}else{var C=a.URL||a.webkitURL,S=C.createObjectURL(t);s?s.location=S:location.href=S,s=null,setTimeout(function(){C.revokeObjectURL(S)},4e4)}});a.saveAs=d.saveAs=d,c.exports=d})})(Z);var Te=Z.exports;const be=({transfers:c,daoDetails:o})=>{const{t:n}=J(),{isOpen:l,close:x}=K("exportCsv"),p=ae({mode:"onChange",defaultValues:{startDate:E({days:30},!0),endDate:E()}}),[a,f]=se({name:["startDate","endDate"],control:p.control}),d=!1,[t,r]=v.useState(),[u,s]=v.useState(!1),[i,y]=v.useState(!1),[g,D]=v.useState(!1),C=v.useMemo(()=>{const h=new Date(a).valueOf(),b=new Date(f).valueOf()+86399999;return c.filter(w=>{const j=Number(w.transferTimestamp)||new Date(w.transferDate).valueOf();return j>=h&&j<=b}).sort((w,j)=>{const m=Number(w.transferTimestamp)||new Date(w.transferDate).valueOf(),k=Number(j.transferTimestamp)||new Date(j.transferDate).valueOf();return m>k?-1:m<k?1:0})},[f,a,c]),S=v.useMemo(()=>{if(!C.length)return"";const h=C.map(m=>{const k=Number(m.transferTimestamp)||new Date(m.transferDate).valueOf(),G=ne(o?.ensDomain)||o?.address||"-";return{Txhash:m.transaction,UnixTimestamp:String(Math.floor(k/1e3)),DateTime:new Date(k).toUTCString().split(",").join(" "),Type:m.transferType===R.Deposit?"deposit":m.transferType===R.Withdraw?"withdraw":"-",From:m?.sender||G,To:m?.to||G,Token:m.tokenSymbol,Quantity:m.tokenAmount,USDvalue:m.usdValue,ProposalId:m?.proposalId?.toString()||"-"}}),b=",",w=h.reduce((m,k)=>m+=Object.values(k).join(b)+`
`,"");return`${Object.keys(h[0]).join(b)}
${w}`},[o?.address,o?.ensDomain,C]),T=v.useCallback(()=>{try{const h=new Blob([S],{type:"text/csv;charset=utf-8;"});r(h),s(!1),y(!0)}catch{s(!0)}},[S]),ee=v.useCallback(async()=>{if(t)try{const h=`export-txns-${Math.floor(Date.now()/1e3)}-${E().split("-").join("")}.csv`;await Te.saveAs(t,h)}catch(h){console.error(h)}finally{D(!0)}},[t,D]),N=v.useCallback(()=>{r(void 0),s(!1),y(!1),D(!1),x()},[x]),te=v.useCallback(()=>{N()},[N]);return e.jsx(re,{isOpen:l,onClose:N,title:g?"":n("finance.modalExport.headerLabel"),subtitle:g?"":n("finance.modalExport.headerDesc"),children:g?e.jsx(oe,{objectIllustration:{object:"SUCCESS"},heading:n("finance.modalExport.feedback.title"),description:n("finance.modalExport.feedback.desc"),primaryButton:{label:n("finance.modalExport.ctaLabelContinue"),className:"w-full",onClick:te}}):e.jsxs(ge,{children:[e.jsx("div",{}),e.jsxs(De,{children:[e.jsxs("form",{className:"space-y-3",children:[e.jsxs(Y,{children:[e.jsx(q,{label:n("labels.startDate")}),e.jsx(P,{name:"startDate",control:p.control,defaultValue:E({days:30},!0),rules:{required:n("errors.required.date")},render:({field:{name:h,value:b,onChange:w,onBlur:j}})=>e.jsx(H,{name:h,value:b,onChange:w,disabled:i,onBlur:j})})]}),e.jsxs(Y,{children:[e.jsx(q,{label:n("labels.endDate")}),e.jsx(P,{name:"endDate",control:p.control,defaultValue:E(),rules:{required:n("errors.required.date")},render:({field:{name:h,value:b,onChange:w,onBlur:j}})=>e.jsx(H,{name:h,value:b,onChange:w,disabled:i,onBlur:j})})]})]}),e.jsxs("div",{className:"space-y-4",children:[i?e.jsx(O,{variant:"primary",size:"lg",className:"w-full",onClick:ee,children:n("finance.modalExport.ctaLabelSave")}):u?e.jsx(O,{variant:"primary",isLoading:d,iconLeft:I.RELOAD,size:"lg",className:"w-full",onClick:T,children:n("finance.modalExport.ctaLabelRetry")}):e.jsxs("div",{className:"flex flex-col items-center gap-4 xl:flex-row",children:[e.jsx(O,{variant:"primary",disabled:u,isLoading:d,size:"lg",className:"w-full",onClick:T,children:n("finance.modalExport.ctaLabelGenerateCSV")}),e.jsx(O,{variant:"tertiary",size:"lg",className:"w-full",onClick:N,children:n("labels.cancel")})]}),u&&e.jsx("div",{className:"flex justify-center text-center",children:e.jsx(_,{message:n("finance.modalExport.alertCritical"),variant:"critical"})}),i&&e.jsx("div",{className:"flex justify-center text-center",children:e.jsx(_,{message:n("finance.modalExport.statusSuccess"),variant:"success"})})]})]})]})})},ge=A.div.attrs({className:"p-6"})``,De=A.div.attrs({className:"space-y-6"})``,Y=A.div.attrs({className:"space-y-3"})``,Ne=()=>{const{open:c}=K(),{t:o,i18n:n}=J(),{handleTransferClicked:l}=le(),{data:x,isLoading:p}=ie(),{data:a,totalTransfers:f}=ye(x?.address??""),[d,t]=v.useState(),r=y=>{t(y==="all"?void 0:y)},u=v.useCallback(y=>d==null||y.transferType===d,[d]),s=v.useMemo(()=>({week:a.week.filter(u),month:a.month.filter(u),year:a.year.filter(u)}),[a.week,a.month,a.year,u]),i=v.useMemo(()=>a.week.length===0&&a.month.length===0&&a.year.length===0,[a.month.length,a.week.length,a.year.length]);return p?e.jsx(ce,{}):e.jsxs(e.Fragment,{children:[e.jsx(be,{daoDetails:x,transfers:[...a.year,...a.month,...a.week]}),e.jsx(me,{title:o("TransferModal.allTransfers"),description:`${f} Total Volume`,primaryBtnProps:{label:o("TransferModal.newTransfer"),iconLeft:e.jsx(de,{icon:I.PLUS}),onClick:()=>c("transfer")},children:e.jsxs("div",{className:"mt-6 xl:mt-16",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs(ue,{bgWhite:!0,defaultValue:"all",onChange:r,children:[e.jsx(B,{value:"all",label:o("labels.all")}),e.jsx(B,{value:R.Deposit,label:o("labels.deposit")}),e.jsx(B,{value:R.Withdraw,label:o("labels.withdraw")})]}),!i&&e.jsx($.Container,{customTrigger:e.jsx(O,{variant:"tertiary",size:"md",iconLeft:I.DOTS_VERTICAL}),children:e.jsx($.Item,{onClick:()=>{c("exportCsv")},children:o("label.exportCSV")})})]})}),i?e.jsx(F,{children:e.jsx("p",{children:o("allTransfer.noTransfers")})}):e.jsxs(e.Fragment,{children:[s.week.length>0&&e.jsx(F,{children:e.jsx(U,{title:o("allTransfer.thisWeek"),children:e.jsx("div",{className:"my-4 space-y-3 border-solid",children:e.jsx(W,{transfers:s.week,onTransferClick:l})})})}),s.month.length!==0&&e.jsx(F,{children:e.jsx(U,{title:Q(new Date,"MMMM",{locale:fe[n.language]}),children:e.jsx("div",{className:"my-4 space-y-3 border-solid",children:e.jsx(W,{transfers:s.month,onTransferClick:l})})})}),s.year.length!==0&&e.jsx(F,{children:e.jsx(U,{title:Q(new Date,"yyyy"),children:e.jsx("div",{className:"my-4 space-y-3 border-solid",children:e.jsx(W,{transfers:s.year,onTransferClick:l})})})})]})]})})]})},F=A.div.attrs({className:"my-6 xl:my-10"})``;export{Ne as Transfers};
