import{y as T,g as us,u as E,G as L,ar as D,q as s,as as B,am as J,al as _,ao as ps,au as Ts,I as Y,an as hs,aG as Ls,at as Ms,A as G,w as W,t as ks,aF as N,aD as Fs,Q as Hs,aX as Vs,ah as rs,e as xs,z as fs,j as js,bw as bs,k as qs,ap as Bs,aB as Ps,bM as Rs,a3 as zs,dv as Gs,b9 as X,cv as _s}from"./main-1e616d6f.js";import{r as u}from"./tiptap-313d156f.js";import{b as Os}from"./accordionSummary-a06aa21e.js";const ns=({actionIndex:e,fieldIndex:r,onClear:t,onEnterDaoAddress:d,isModalOpened:a,daoAddress:p,ensName:c})=>{const{t:m}=E(),{api:l}=J(),{alert:n}=_(),{control:h}=L(),f=D({name:`actions.${e}.inputs.mintTokensToWallets`,control:h}),b=u.useCallback(()=>{n(m("alert.chip.inputCleared")),t?.(r)},[n,r,t,m]),o=u.useCallback((k,j)=>{(k.address===p?.toLowerCase()||c&&k.ensName===c.toLowerCase())&&!a?(d?.(r),j({address:"",ensName:""})):j(k)},[p,c,r,a,d]),v=u.useCallback(async k=>{const j=new ps(l,k.address,k.ensName);let w=await Ts(j,m("errors.required.walletAddress"),m);return f?.some(({web3Address:y},M)=>(y.address===j.address||y.ensName===j.ensName)&&M!==r)&&(w=m("errors.duplicateAddress")),w},[r,l,m,f]);return s.jsx(Y,{defaultValue:{address:"",ensName:""},name:`actions.${e}.inputs.mintTokensToWallets.${r}.web3Address`,rules:{validate:v},render:({field:{name:k,ref:j,value:w,onBlur:y,onChange:M},fieldState:{error:F}})=>s.jsx(Us,{children:s.jsx(hs,{name:k,state:F&&"critical",value:w,onBlur:y,onChange:O=>o(O,M),error:F?.message,resolveLabels:"onBlur",onClearButtonClick:b,ref:j})})})},os=({actionIndex:e,fieldIndex:r})=>{const{trigger:t}=L(),{t:d}=E(),a=p=>Number(p)>0?!0:d("errors.lteZero");return u.useEffect(()=>{t(`actions.${e}.inputs.mintTokensToWallets.${r}.amount`)},[e,r,t]),s.jsx(Y,{name:`actions.${e}.inputs.mintTokensToWallets.${r}.amount`,rules:{required:d("errors.required.amount"),validate:a},render:({field:{name:p,value:c,onBlur:m,onChange:l},fieldState:{error:n}})=>s.jsxs("div",{className:"flex-1 xl:w-[184px] xl:flex-none",children:[s.jsx(Ls,{name:p,value:c,onBlur:m,onChange:h=>{t(`actions.${e}.inputs.mintTokensToWallets.${r}.address`),l(h)},placeholder:"0",min:0,includeDecimal:!0,mode:n?.message?"critical":"default"}),n?.message&&s.jsx(Zs,{children:s.jsx(Ms,{message:n.message,variant:"critical"})})]})})},ls=({fieldIndex:e,onDelete:r,disabled:t=!1})=>{const{t:d}=E(),{alert:a}=_();return s.jsx(G.Container,{align:"start",disabled:t,customTrigger:s.jsx(W,{variant:"tertiary",size:"lg",iconLeft:ks.DOTS_VERTICAL}),children:s.jsx(G.Item,{onClick:()=>{r(e),a(d("alert.chip.removedAddress"))},children:d("labels.removeWallet")})})},is=({actionIndex:e,fieldIndex:r,newTokenSupply:t})=>{const d=D({name:`actions.${e}.inputs.mintTokensToWallets.${r}.amount`});let a;try{a=t&&!t.eq(N(0))?N(d).div(t).mul(N(100)):N(0)}catch{a=N(0)}return s.jsx("div",{className:"w-24",children:s.jsx(Fs,{className:"text-right",name:`actions.${e}.inputs.mintTokensToWallets.${r}.amount`,value:a.toPrecision(3)+"%",mode:"default",disabled:!0})})},Qs=({actionIndex:e,fieldIndex:r,onDelete:t,onClear:d,newTokenSupply:a,onEnterDaoAddress:p,isModalOpened:c,daoAddress:m,ensName:l})=>{const{isDesktop:n}=us(),{t:h}=E(),{control:f}=L(),b=D({name:`actions.${e}.inputs.mintTokensToWallets`,control:f});return n?s.jsx(ds,{children:s.jsxs(ms,{children:[s.jsx(ns,{actionIndex:e,fieldIndex:r,onClear:d,onEnterDaoAddress:p,isModalOpened:c,ensName:l,daoAddress:m}),s.jsx(os,{actionIndex:e,fieldIndex:r}),s.jsx(is,{actionIndex:e,fieldIndex:r,newTokenSupply:a}),s.jsx(ls,{actionIndex:e,fieldIndex:r,onDelete:t,disabled:b.length===1})]})}):s.jsxs(ds,{children:[s.jsxs(cs,{children:[s.jsx(B,{label:h("labels.whitelistWallets.address")}),s.jsxs(ms,{children:[s.jsx(ns,{actionIndex:e,fieldIndex:r,onClear:d,onEnterDaoAddress:p,isModalOpened:c,ensName:l,daoAddress:m}),s.jsx(ls,{actionIndex:e,fieldIndex:r,onDelete:t,disabled:b.length===1})]})]}),s.jsxs(cs,{children:[s.jsx(B,{label:h("finance.tokens")}),s.jsxs(Ks,{children:[s.jsx(os,{actionIndex:e,fieldIndex:r}),s.jsx(is,{actionIndex:e,fieldIndex:r,newTokenSupply:a})]})]})]})},ds=T.div.attrs({className:"p-4 md:p-6 space-y-6"})``,Zs=T.div.attrs({className:"mt-1"})``,cs=T.div.attrs({className:"space-y-1"})``,ms=T.div.attrs({className:"flex space-x-4"})``,Ks=T.div.attrs({className:"flex md:pr-16 space-x-4"})``,Us=T.div.attrs({className:"flex-1 space-y-2"})``,Xs=({isOpen:e,onClose:r,onCloseReset:t,daoAddress:d})=>{const{t:a}=E(),[p,c]=u.useState(0),{api:m}=J(),{control:l,resetField:n}=L(),h=D({name:"mintTokensToTreasury",control:l}),f=u.useMemo(()=>!!(h&&(h.address.toLowerCase()===d.address?.toLowerCase()||h.ensName.toLowerCase()===d.ensName?.toLowerCase())),[d.address,d.ensName,h]),b=u.useCallback(async o=>Ts(new ps(m,o.address,o.ensName),a("errors.required.walletAddress"),a),[m,a]);return s.jsx(Hs,{isOpen:e,onCloseReset:t,children:p===0?s.jsxs("div",{className:"flex flex-col gap-y-3 p-6",children:[s.jsx(Vs,{objectIllustration:{object:"WARNING"},heading:a("modal.mintTokensToTreasury.title"),description:a("modal.mintTokensToTreasury.description")}),s.jsx(rs,{variant:"critical",message:a("modal.mintTokensToTreasury.alertTitle"),description:a("modal.mintTokensToTreasury.alertDescription")}),s.jsx(W,{variant:"primary",onClick:()=>{t(),c(0)},children:a("modal.mintTokensToTreasury.step1CtaLabel")}),s.jsx(W,{variant:"secondary",onClick:()=>{c(1)},children:a("modal.mintTokensToTreasury.step1CancelLabel")})]}):s.jsxs(s.Fragment,{children:[s.jsxs(Ys,{children:[s.jsx(W,{variant:"tertiary",size:"sm",iconLeft:ks.CHEVRON_LEFT,onClick:()=>{c(0),n("mintTokensToTreasury")}}),s.jsx(Js,{children:a("modal.mintTokensToTreasury.title")}),s.jsx("div",{role:"presentation",className:"h-8 w-8"})]}),s.jsxs("div",{className:"flex flex-col px-4 py-6",children:[s.jsx(Is,{children:a("modal.mintTokensToTreasury.inputLabel")}),s.jsx(se,{children:a("modal.mintTokensToTreasury.inputHelptext")}),s.jsx(Y,{defaultValue:{address:"",ensName:""},name:"mintTokensToTreasury",control:l,rules:{validate:b},render:({field:{name:o,ref:v,value:k,onBlur:j,onChange:w},fieldState:{error:y}})=>s.jsxs(s.Fragment,{children:[s.jsx(te,{children:s.jsx(hs,{name:o,state:y&&"critical",value:k,onBlur:j,onChange:w,error:y?.message,ref:v})}),s.jsx("div",{className:"mb-3 mt-6",children:s.jsx(rs,{variant:"critical",message:a("modal.mintTokensToTreasury.alertTitle"),description:a("modal.mintTokensToTreasury.alertDescription")})}),s.jsxs(ee,{children:[s.jsx(W,{variant:"primary",size:"lg",onClick:()=>{r(),c(0)},disabled:!f,children:a("modal.mintTokensToTreasury.step2CtaLabel")}),s.jsx(W,{variant:"tertiary",size:"lg",onClick:()=>{n("mintTokensToTreasury"),t(),c(0)},children:a("modal.mintTokensToTreasury.step2CancelLabel")})]})]})})]})]})})},Js=T.div.attrs({className:"flex-1 font-semibold text-center text-neutral-800"})``,Ys=T.div.attrs({className:"flex items-center p-4 space-x-4 bg-neutral-0 rounded-xl sticky top-0"})`
  box-shadow:
    0px 4px 8px rgba(31, 41, 51, 0.04),
    0px 0px 2px rgba(31, 41, 51, 0.06),
    0px 0px 1px rgba(31, 41, 51, 0.04);
`,Is=T.span.attrs({className:"ft-text-base font-semibold text-neutral-800 pb-1"})``,se=T.p.attrs({className:"ft-text-sm text-neutral-600 pb-3"})``,ee=T.div.attrs({className:"flex flex-col w-full space-y-3"})``,te=T.div.attrs({className:"flex-1 space-y-2"})``,ce=({actionIndex:e,allowRemove:r=!0})=>{const{t}=E(),{alert:d}=_(),{network:a}=xs(),{data:p}=js(),{data:c}=bs(p?.plugins[0].instanceAddress),{removeAction:m}=_s(),{setValue:l,clearErrors:n,resetField:h}=L(),f=()=>{n(`actions.${e}`),h(`actions.${e}`),l(`actions.${e}.inputs.mintTokensToWallets`,[]),d(t("alert.chip.resetAction"))},b=(()=>{const o=[s.jsx(G.Item,{onClick:f,children:t("labels.resetAction")},0)];return r&&o.push(s.jsx(G.Item,{onClick:()=>{m(e),d(t("alert.chip.removedAction"))},children:t("labels.removeEntireAction")},1)),o})();return s.jsx(Os,{type:"action-builder",methodName:t("labels.mintTokens"),smartContractName:"GovernanceERC20",smartContractAddress:c?.address,blockExplorerLink:c?.address?`${fs[a].explorer}token/${c?.address}`:void 0,verified:!0,methodDescription:t("newProposal.mintTokens.methodDescription"),additionalInfo:t("newProposal.mintTokens.additionalInfo"),dropdownItems:b,children:s.jsx(ae,{actionIndex:e})})},ae=({actionIndex:e,standAlone:r=!1})=>{const{t}=E(),{isDesktop:d}=us(),{network:a}=xs(),{api:p}=J(),{alert:c}=_(),m=fs[a].nativeCurrency,{data:l}=js(),{data:n,isLoading:h}=bs(l?.plugins[0].instanceAddress||""),{data:{memberCount:f},isLoading:b}=qs(l?.plugins[0].instanceAddress,l?.plugins[0].id,{countOnly:!0}),{setValue:o,trigger:v,formState:k,control:j,resetField:w}=L(),{fields:y,append:M,replace:F,remove:O,update:ys}=Bs({name:`actions.${e}.inputs.mintTokensToWallets`}),C=D({name:`actions.${e}.inputs.mintTokensToWallets`}),I=D({name:`actions.${e}.name`,control:j}),[H,Cs]=u.useState(N(0)),[Q,Ns]=u.useState(0),[ss,vs]=u.useState(()=>new Set),[es,ws]=u.useState(()=>new Set),[ts,Z]=u.useState(0),[V,K]=u.useState({status:!1}),gs=V.index!==void 0,q=`actions.${e}.inputs.mintTokensToWallets.${V.index}.web3Address`;u.useEffect(()=>{y.length===0&&F({web3Address:{address:"",ensName:""},amount:"0"}),I||o(`actions.${e}.name`,"mint_tokens")},[e,I,F,y.length,o]),u.useEffect(()=>{if(!C)return;k.errors?.actions?.[`${e}`]?.inputs?.mintTokensToWallets?.forEach(x=>{x?.address&&v(x.address.ref?.name)})},[e,k.errors?.actions,v,C]),u.useEffect(()=>{n?.address&&!b&&Ps(n.address,p,m).then(i=>{const x=parseFloat(Rs(i.totalSupply,i.decimals));Ns(x),o(`actions.${e}.summary.tokenSupply`,x),o(`actions.${e}.summary.daoTokenSymbol`,n.symbol),o(`actions.${e}.summary.daoTokenAddress`,n.address),o(`actions.${e}.summary.totalMembers`,f)}).catch(i=>console.error("Error happened when fetching token infos: ",i))},[n?.address,m,p,o,e,n?.symbol,f,b]),u.useEffect(()=>{if(C&&n?.address){const i=C.filter(g=>g.address!==""&&zs.isAddress(g.address)),x=i.filter(g=>!ss.has(g.address));if(i.length===0)Z(0),o(`actions.${e}.summary.newHoldersCount`,0);else if(x.length===0){const g=i.filter(A=>es.has(A.address)).length;Z(g),o(`actions.${e}.summary.newHoldersCount`,g)}else{const g=x.map(A=>Gs(n.address,A.address,p,m,!1).then(P=>({address:A.address,balance:P})));Promise.all(g).then(A=>{const P=A.filter($=>$.balance.isZero());ws($=>{const S=new Set($);return P.forEach(U=>S.add(U.address)),S}),vs($=>{const S=new Set($);return x.forEach(U=>S.add(U.address)),S});const as=C.filter($=>P.some(S=>S.address===$.address)).length;Z(as),o(`actions.${e}.summary.newHoldersCount`,as)}).catch(A=>console.error("Error happened when fetching balances: ",A))}}},[C,n?.address,e,ss,p,m,es,o]),u.useEffect(()=>{if(C){let i=N(0);C.forEach(x=>{try{i=i.plus(N(x.amount))}catch{console.warn("An input contains an invalid amount of tokens to be minted.")}}),i.eq(H)||(Cs(i),o(`actions.${e}.summary.newTokens`,i.toNumber()))}},[e,C,H,o]);const As=()=>{M({web3Address:{address:"",ensName:""},amount:"0"})},$s=i=>{ys(i,{web3Address:{address:"",ensName:""},amount:C[i].amount})},Ss=i=>{O(i),setTimeout(()=>{v(`actions.${e}.inputs.mintTokensToWallets`)},450)},Ws=i=>{K({status:!0,index:i})},Es=u.useCallback(()=>{K({status:!1}),w(q,{defaultValue:{address:"",ensName:""}}),c(t("modal.mintTokensToTreasury.alertChipSuccess"))},[c,w,t,q]),Ds=u.useCallback(()=>{K({...V,status:!1}),o(q,{address:l?.address,ensName:X(l?.ensDomain)}),setTimeout(()=>v(q),50),c(t("modal.mintTokensToTreasury.alertChipCritical"))},[c,l?.address,l?.ensDomain,V,o,t,q,v]);return s.jsxs(s.Fragment,{children:[s.jsxs(re,{standAlone:r,children:[d&&s.jsxs("div",{className:"flex items-center space-x-4 p-4 md:p-6 ",children:[s.jsx("div",{className:"flex-1",children:s.jsx(B,{label:t("labels.whitelistWallets.address")})}),s.jsx("div",{className:"w-[184px]",children:s.jsx(B,{label:t("finance.tokens")})}),s.jsx("div",{className:"w-24",children:s.jsx(B,{label:t("finance.allocation")})}),s.jsx("div",{className:"w-12"})]}),y.map((i,x)=>s.jsx(Qs,{actionIndex:e,fieldIndex:x,onClear:$s,onDelete:Ss,newTokenSupply:H.plus(N(Q)),onEnterDaoAddress:Ws,isModalOpened:gs,daoAddress:l?.address,ensName:X(l?.ensDomain)},i.id)),s.jsx(ne,{children:s.jsx(W,{variant:"tertiary",size:"lg",className:"flex-1 md:flex-initial",onClick:As,children:t("labels.addWallet")})}),!h&&s.jsxs(oe,{children:[s.jsx("p",{className:"font-semibold text-neutral-800",children:t("labels.summary")}),s.jsxs(R,{children:[s.jsx(z,{children:t("labels.newTokens")}),s.jsxs("p",{children:["+",""+H," ",n?.symbol]})]}),s.jsxs(R,{children:[s.jsx(z,{children:t("labels.newHolders")}),s.jsxs("p",{children:["+",ts]})]}),s.jsxs(R,{children:[s.jsx(z,{children:t("labels.totalTokens")}),Q?s.jsxs("p",{children:[""+H.plus(N(Q))," ",n?.symbol]}):s.jsx("p",{children:"..."})]}),s.jsxs(R,{children:[s.jsx(z,{children:t("labels.totalHolders")}),s.jsx("p",{children:ts+f})]})]})]}),s.jsx(Xs,{isOpen:V.status,onClose:Ds,onCloseReset:Es,daoAddress:{address:l?.address,ensName:X(l?.ensDomain)}})]})},re=T.div.attrs(({standAlone:e})=>({className:`bg-neutral-0 border divide-y border-neutral-100 divide-neutral-100 ${e?"rounded-xl":"rounded-b-xl border-t-0"}`}))``,ne=T.div.attrs({className:"flex justify-between md:justify-start p-4 md:p-6 space-x-4"})``,oe=T.div.attrs({className:"p-4 md:p-6 space-y-3 font-semibold text-neutral-800"})``,R=T.div.attrs({className:"flex justify-between"})``,z=T.p.attrs({className:"font-normal text-neutral-500"})``;export{ae as M,ce as a};
